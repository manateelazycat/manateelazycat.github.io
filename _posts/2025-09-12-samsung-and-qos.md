---
layout: post
title: 从误会三星手机到网络打洞
categories: [LNKS]
---

前年测试微服网络的时候，有段时间全武汉开车到处跑测试网络穿透，那段时间基本上是全员测试。

女同事上班就去山姆，商场，母婴店来模拟女性用户经常去的地方。男同事就去机场，高铁站，地铁站，医院 CT 检查室旁测试（妈呀，这样一看中年男人真是纯牛马呀）。

经过一段时间的测试，穿透效果很牛逼，到处都可以用。

直到有一天我换了三星的顶配手机，说句实话，三星的手机除了屏幕宽一点，单手玩手机困难（我的手小），还挺好用的。直到第三天用一用的，网速掉到 2kb/s，那时候别说云服务了，微信发个照片都困难。

为了测试三星的售后服务体系，我就开始线上线下找他们客服，你也知道电话上就听着不专业。我专门跑到线下售后中心，气个半死，三星国内的售后都是外包的，要态度没态度，要担当没担当，当天把我惹冒火了，就把三星的手机退了。

退了以后又换回 vivo，发现也降速了，而且开始的时候满速，过了 5 分钟就开始直线下降，直至 2kb/s。看来错怪三星的手机了。

硬件产品跟电磁波的都是玄学，我就拿着 vivo 手机找研发同学，研发同学说基站的问题，那我肯定不相信啊。当然打脸也要讲证据，我就开车几十公里到处测试不同基站，效果都一样。而且换了一个手机也复现了，换了三大运营商的卡也复现了，肯定不是手机和电话卡的问题。

排除硬件和网络的问题，我又去找研发同学。无解。这个世界上当你把其他的锅都掀开看没问题的时候，可以看看自己的锅盖盖好没？我又拿着一堆手机和一堆卡开车到处转，这次测试是，6 个手机装了三个运营商卡和懒猫微服客户端，6 个手机装了三个运营商卡但不装懒猫微服客户端。做实验要科学呀，我有时候调试硬件系统网络问题的时候，感觉自己像个医生，在做药理对比实验。

最后又测了一圈，发现不装懒猫微服的客户端都是好的，这下好了，铁证如山（三星表示我很冤枉），研发同学硬着去看代码。

经过一周排查，发现打洞不能单一的用 UDP 打洞，UDP 打洞虽然快，但是容易受运营商 QOS，我们现象也符合场景，链接数太多导致被运营商降速了。

最后，我们结合 TCP 打洞，UDP 打洞和加密中继三种方式混合打洞，不同运营商策略跑对应的代码，最后终于做到内网穿透又快又准，还不会被运营商限制。

从这故事告诉我们，大多数问题技术上都是可以解决的，关键是技术测试的方法和逻辑要严密，能稳定复现就成功一半了。

老板们，来一台懒猫微服吧，在中国地狱网络环境中，穿透能力最强的产品，穿透后家中英伟达 5090 设备轻松暴露到手机里，再加上虚拟内网和 MFA 二次认证，黑客都无法攻击，超级超级安全。
