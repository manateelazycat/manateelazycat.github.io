<!DOCTYPE html>

<html>
    <head>
        <meta name="viewport" content="width=device-width, initial-scale=1">
<meta http-equiv="content-type" content="text/html; charset=utf-8" />
<script src="https://cdn1.lncld.net/static/js/av-min-1.5.0.js"></script>
<title>基于抽象语法树的结构编辑插件</title>


        <link rel="stylesheet" href="//manateelazycat.github.io/styles/font.css">
        <link rel="stylesheet" media="screen and (min-width: 600px)" href="//manateelazycat.github.io/styles/post.css">
        <link rel="stylesheet" media="screen and (max-width: 600px)" href="//manateelazycat.github.io/styles/post_mobile.css">
        <link rel="stylesheet" media="screen and (min-width: 600px)" href="//manateelazycat.github.io/styles/navigatebar.css">
        <link rel="stylesheet" media="screen and (max-width: 600px)" href="//manateelazycat.github.io/styles/navigatebar_mobile.css">
        <link rel="stylesheet" href="//manateelazycat.github.io/theme/highlight.css">
    </head>
    <body>
        <div class="navigatebar">
    <div class="navigatebar-button navigatebar-mine">
        <a href="//manateelazycat.github.io/index.html">ManateeLazyCat</a>
    </div>
    <div class="navigatebar-button">
        <a href="//manateelazycat.github.io/tags.html">Tags</a>
    </div>
    <div class="navigatebar-button">
        <a href="//manateelazycat.github.io/projects.html">Projects</a>
    </div>
    <div class="navigatebar-button">
        <a href="//manateelazycat.github.io/feed.xml">Feeds</a>
    </div>
    <div class="navigatebar-button navigatebar-about">
        <a href="//manateelazycat.github.io/about.html">About</a>
    </div>
</div>

        <div class="content-area">
            <div class="title">
                基于抽象语法树的结构编辑插件
            </div>
            <div class="category-area">
                「
                <a href="//manateelazycat.github.io/tags.html#Emacs">
                    <div class="category">
                        Emacs
                    </div>
                </a>
                」
            </div>
            <div class="char-counter">
                字数3187 2021-11-26
            </div>
            <div class="content">
                <p><a href="https://github.com/manateelazycat/grammatical-edit">https://github.com/manateelazycat/grammatical-edit</a> 是基于 tree-sitter 的结构化编辑插件, 这个插件最主要的优点是基于<a href="https://github.com/tree-sitter/tree-sitter">tree-sitter</a>的抽象语法树，而不是正则来实现语法对象编辑，只要tree-sitter支持的编程语言，都可以进行结构性编辑，不需要像 smartparens 或者 awesome-pair.el 针对一些偏门语言增加 workaround, 甚至是未来发布的新编程语言都可以立即支持。</p>

<h3 id="安装方法">安装方法</h3>
<ol>
  <li>先安装 tree-sitter: https://emacs-tree-sitter.github.io/installation/</li>
  <li>下载 <a href="https://github.com/manateelazycat/grammatical-edit">https://github.com/manateelazycat/grammatical-edit</a>, 把 grammatical-edit 加到 load-path 中</li>
</ol>

<h3 id="配置启用的语言">配置启用的语言</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(require 'grammatical-edit)

(dolist (hook (list
               'c-mode-common-hook
               'c-mode-hook
               'c++-mode-hook
               'java-mode-hook
               'haskell-mode-hook
               'emacs-lisp-mode-hook
               'lisp-interaction-mode-hook
               'lisp-mode-hook
               'maxima-mode-hook
               'ielm-mode-hook
               'sh-mode-hook
               'makefile-gmake-mode-hook
               'php-mode-hook
               'python-mode-hook
               'js-mode-hook
               'go-mode-hook
               'qml-mode-hook
               'jade-mode-hook
               'css-mode-hook
               'ruby-mode-hook
               'coffee-mode-hook
               'rust-mode-hook
               'qmake-mode-hook
               'lua-mode-hook
               'swift-mode-hook
               'minibuffer-inactive-mode-hook
               ))
  (add-hook hook '(lambda () (grammatical-edit-mode 1))))
</code></pre></div></div>

<h3 id="快捷键配置">快捷键配置</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>(define-key grammatical-edit-mode-map (kbd "(") 'grammatical-edit-open-round)
(define-key grammatical-edit-mode-map (kbd "[") 'grammatical-edit-open-bracket)
(define-key grammatical-edit-mode-map (kbd "{") 'grammatical-edit-open-curly)
(define-key grammatical-edit-mode-map (kbd ")") 'grammatical-edit-close-round)
(define-key grammatical-edit-mode-map (kbd "]") 'grammatical-edit-close-bracket)
(define-key grammatical-edit-mode-map (kbd "}") 'grammatical-edit-close-curly)
(define-key grammatical-edit-mode-map (kbd "=") 'grammatical-edit-equal)

(define-key grammatical-edit-mode-map (kbd "%") 'grammatical-edit-match-paren)
(define-key grammatical-edit-mode-map (kbd "\"") 'grammatical-edit-double-quote)

(define-key grammatical-edit-mode-map (kbd "SPC") 'grammatical-edit-space)
(define-key grammatical-edit-mode-map (kbd "RET") 'grammatical-edit-newline)

(define-key grammatical-edit-mode-map (kbd "M-o") 'grammatical-edit-backward-delete)
(define-key grammatical-edit-mode-map (kbd "C-d") 'grammatical-edit-forward-delete)
(define-key grammatical-edit-mode-map (kbd "C-k") 'grammatical-edit-kill)

(define-key grammatical-edit-mode-map (kbd "M-\"") 'grammatical-edit-wrap-double-quote)
(define-key grammatical-edit-mode-map (kbd "M-[") 'grammatical-edit-wrap-bracket)
(define-key grammatical-edit-mode-map (kbd "M-{") 'grammatical-edit-wrap-curly)
(define-key grammatical-edit-mode-map (kbd "M-(") 'grammatical-edit-wrap-round)
(define-key grammatical-edit-mode-map (kbd "M-)") 'grammatical-edit-unwrap)

(define-key grammatical-edit-mode-map (kbd "M-p") 'grammatical-edit-jump-right)
(define-key grammatical-edit-mode-map (kbd "M-n") 'grammatical-edit-jump-left)
(define-key grammatical-edit-mode-map (kbd "M-:") 'grammatical-edit-jump-out-pair-and-newline)
</code></pre></div></div>

<h3 id="添加-tree-sitter-对-elisp-的支持">添加 tree-sitter 对 elisp 的支持</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. git clone https://github.com/Wilfred/tree-sitter-elisp
2. gcc ./src/parser.c -fPIC -I./ --shared -o elisp.so
3. cp ./elisp.so ~/.tree-sitter-langs/bin
(tree-sitter-load 'elisp "elisp")
(add-to-list 'tree-sitter-major-mode-language-alist '(emacs-lisp-mode . elisp))
</code></pre></div></div>
<h3 id="添加vue对tree-sitter支持">添加Vue对tree-sitter支持</h3>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>1. git clone https://github.com/ikatyang/tree-sitter-vue.git
2. gcc ./src/parser.c ./src/scanner.cc -fPIC -I./ --shared -o vue.so
3. cp ./vue.so ~/.tree-sitter-langs/bin (~/.tree-sitter-langs/bin is path of your tree-sitter-langs repo)
(tree-sitter-load 'vue "vue")
(add-to-list 'tree-sitter-major-mode-language-alist '(web-mode . vue))
</code></pre></div></div>

<p>更多关于tree-sitter的配置可以参考<a href="https://github.com/manateelazycat/lazycat-emacs/blob/master/site-lisp/config/init-tree-sitter.el">我的配置文件</a></p>

            </div>
        </div>
    </body>
</html>
