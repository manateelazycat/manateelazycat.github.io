I"×<p>LSP (Language Server Protocol) æ˜¯å¾®è½¯é¢†å¯¼å¼€å‘çš„ç¼–ç¨‹è¯­è¨€è¯­æ³•è¡¥å…¨å’Œä»£ç åˆ†ææ¡†æ¶, å¥½å¤„æ˜¯å…¨ä¸–ç•Œé»‘å®¢éƒ½ä¸€èµ·å¼€å‘ LSP åç«¯, ä¸è®ºä½ ç”¨çš„æ˜¯ Emacs, Vim è¿˜æ˜¯ Sublime, VSCode, Elicpse, IntelliJ ç­‰ç¼–ç¨‹å·¥å…·, éƒ½å¯ä»¥äº«å—åŒç­‰æ™ºèƒ½çš„è¯­æ³•è¡¥å…¨åç«¯.</p>

<p>Emacs çš„ <a href="https://github.com/emacs-lsp/lsp-mode">lsp-mode</a> æ˜¯LSPåè®®åœ¨Emacsçš„å®¢æˆ·ç«¯å®ç°.
lsp-modeç°åœ¨èƒ½å¤Ÿå¾ˆå¥½çš„æ”¯æŒ C++, Python, Ruby, Golang, Haskell, OCamel, Rust, PHPç­‰è¯­è¨€.
å½“ç„¶ä¹ŸåŒ…æ‹¬ JavaScript.</p>

<p>lsp-mode å¯¹ JavaScript çš„é»˜è®¤è¡¥å…¨ä¸»è¦é  javascript-typescript-langserver è¿™ä¸ªåç«¯æ¥å®ç°.</p>

<p>tide ä½¿ç”¨çš„æ˜¯ <a href="https://github.com/Microsoft/TypeScript/wiki/Standalone-Server-%28tsserver%29">tsserver</a>, ä¹Ÿå°±æ˜¯å¾®è½¯ç»™ VSCode å¼€å‘çš„JavaScriptæ™ºèƒ½è¡¥å…¨åç«¯, å¯ä»¥å¾ˆå¥½çš„æ”¯æŒ JavaScript å’Œ TypeScript.</p>

<h2 id="å®‰è£…æ–¹æ³•">å®‰è£…æ–¹æ³•</h2>

<h3 id="1-å®‰è£…-tsserver-è¡¥å…¨åç«¯">1. å®‰è£… tsserver è¡¥å…¨åç«¯</h3>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>npm <span class="nb">install</span> <span class="nt">-g</span> typescript
npm <span class="nb">install </span>jquery <span class="nt">--save</span>
</code></pre></div></div>

<ol>
  <li>typescript è¿™ä¸ªåŒ…ä¼šå®‰è£… tsserver</li>
  <li>jquery â€“save è¿™ä¸ªåŒ…å®‰è£…ä»¥å, tsserver å°±ä¸ä¼šæŠ±æ€¨æ‰¾ä¸åˆ° JQuery çš„ $ ç¬¦å·äº† ;)</li>
</ol>

<h3 id="2-å®‰è£…-tide">2. å®‰è£… tide</h3>
<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code>
<span class="o">```</span><span class="nv">Elisp</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">'tide</span><span class="p">)</span>

<span class="p">(</span><span class="nb">dolist</span> <span class="p">(</span><span class="nv">hook</span> <span class="p">(</span><span class="nb">list</span>
               <span class="ss">'js2-mode-hook</span>
               <span class="ss">'rjsx-mode-hook</span>
               <span class="ss">'typescript-mode-hook</span>
               <span class="p">))</span>
  <span class="p">(</span><span class="nv">add-hook</span> <span class="nv">hook</span> <span class="p">(</span><span class="k">lambda</span> <span class="p">()</span>
                   <span class="c1">;; åˆå§‹åŒ– tide</span>
                   <span class="p">(</span><span class="nv">tide-setup</span><span class="p">)</span>
                   <span class="c1">;; å½“ tsserver æœåŠ¡æ²¡æœ‰å¯åŠ¨æ—¶è‡ªåŠ¨é‡æ–°å¯åŠ¨</span>
                   <span class="p">(</span><span class="nb">unless</span> <span class="p">(</span><span class="nv">tide-current-server</span><span class="p">)</span>
                     <span class="p">(</span><span class="nv">tide-restart-server</span><span class="p">))</span>
                   <span class="p">)))</span>
</code></pre></div></div>

<h2 id="ä½“éªŒ">ä½“éªŒ</h2>
<p>æ‰“å¼€ *.js æ–‡ä»¶å, tide ä¼šè‡ªåŠ¨æŠŠå½“å‰ç›®å½•è¯†åˆ«ä¸º root ç›®å½• (è¿™å¯¹äºå¤§éƒ¨åˆ†çš„ WebPack é¡¹ç›®æ¥è¯´å·²ç»æ˜¯è¶³å¤Ÿäº†çš„)</p>

<p><img src="http://localhost:4000/pics/tide/tide-1.png" alt="Tide è¡¥å…¨" /></p>

<p>å…¶ä»–æ¯”è¾ƒæœ‰ç”¨çš„å‘½ä»¤:</p>
<ol>
  <li>tide-jump-to-definition: è·³è½¬åˆ°å‡½æ•°æˆ–å˜é‡å®šä¹‰çš„åœ°æ–¹</li>
  <li>tide-jump-back: è·³è½¬å®šä¹‰ä»¥åå†è·³è½¬å›æ¥</li>
  <li>tide-rename-symbol: è¯­æ³•é‡å‘½åç¬¦å·</li>
  <li>tide-rename-file: é‡å‘½åJSæ–‡ä»¶</li>
</ol>

<p>ä¹Ÿå¯ä»¥åƒè¿™æ ·ç”¨ <code class="highlighter-rouge">tide-references</code> å‘½ä»¤æŸ¥æ‰¾ç¬¦å·æ‰€æœ‰è¯­æ³•å¼•ç”¨çš„åœ°æ–¹.</p>

<p><img src="http://localhost:4000/pics/tide/tide-2.png" alt="Tide åå‘å¼•ç”¨" /></p>

<p>æ›´å¤šå‘½ä»¤è¯·å‚è€ƒ <a href="https://github.com/ananthakumaran/tide">Tide github</a></p>

<p>å‰é¢è¯´çš„ lsp-mode é»˜è®¤ä½¿ç”¨ javascript-typescript-langserver è¿™ä¸ªåç«¯, å…¶å®æ¢æˆ typescript-language-server (tsserver çš„å°è£…) ä¹Ÿå¯ä»¥è¾¾åˆ° tide çš„åŒæ ·æ•ˆæœ, ç±»ä¼¼çš„é…ç½®å¦‚ä¸‹:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="nb">require</span> <span class="ss">'lsp-typescript</span><span class="p">)</span>

<span class="c1">;; Javascript, Typescript and Flow support for lsp-mode</span>
<span class="c1">;;</span>
<span class="c1">;; Install:</span>
<span class="c1">;;</span>
<span class="c1">;; npm install -g typescript</span>
<span class="c1">;; npm install -g typescript-language-server</span>
<span class="c1">;;</span>
<span class="c1">;; Fixed error "[tsserver] /bin/sh: /usr/local/Cellar/node/10.5.0_1/bin/npm: No such file or directory" :</span>
<span class="c1">;;</span>
<span class="c1">;; sudo ln -s /usr/local/bin/npm /usr/local/Cellar/node/10.5.0_1/bin/npm</span>
<span class="c1">;;</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'js-mode-hook</span> <span class="nf">#'</span><span class="nv">lsp-typescript-enable</span><span class="p">)</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'typescript-mode-hook</span> <span class="nf">#'</span><span class="nv">lsp-typescript-enable</span><span class="p">)</span> <span class="c1">;; for typescript support</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'js3-mode-hook</span> <span class="nf">#'</span><span class="nv">lsp-typescript-enable</span><span class="p">)</span> <span class="c1">;; for js3-mode support</span>
<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'rjsx-mode</span> <span class="nf">#'</span><span class="nv">lsp-typescript-enable</span><span class="p">)</span> <span class="c1">;; for rjsx-mode support</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">lsp-company-transformer</span> <span class="p">(</span><span class="nv">candidates</span><span class="p">)</span>
  <span class="p">(</span><span class="k">let</span> <span class="p">((</span><span class="nv">completion-ignore-case</span> <span class="no">t</span><span class="p">))</span>
    <span class="p">(</span><span class="nv">all-completions</span> <span class="p">(</span><span class="nv">company-grab-symbol</span><span class="p">)</span> <span class="nv">candidates</span><span class="p">)))</span>

<span class="p">(</span><span class="nb">defun</span> <span class="nv">lsp-js-hook</span> <span class="no">nil</span>
  <span class="p">(</span><span class="nv">make-local-variable</span> <span class="ss">'company-transformers</span><span class="p">)</span>
  <span class="p">(</span><span class="nb">push</span> <span class="ss">'lsp-company-transformer</span> <span class="nv">company-transformers</span><span class="p">))</span>

<span class="p">(</span><span class="nv">add-hook</span> <span class="ss">'js-mode-hook</span> <span class="ss">'lsp-js-hook</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="å¤‡æ³¨">å¤‡æ³¨</h3>
<p>è¯·ç›´æ¥ä½¿ç”¨js-mode, ä¸è¦ä½¿ç”¨ js2-mode æˆ–è€…åŸºäº js2-mode çš„æ’ä»¶(æ¯”å¦‚ rjsx-mode), js2-mode ä¼šå¯¼è‡´ç¼–è¾‘ JS æ–‡ä»¶æ—¶éå¸¸éå¸¸å¡é¡¿.</p>
:ET