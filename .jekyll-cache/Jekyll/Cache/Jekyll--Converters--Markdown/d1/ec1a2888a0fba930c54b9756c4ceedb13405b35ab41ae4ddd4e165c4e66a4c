I"Îa<p>æœ€è¿‘åœ¨çœ‹ ã€ŠFlex &amp; Bisonã€‹ è¿™æœ¬ä¹¦, é’ˆå¯¹ä¹¦ä¸­çš„ä¾‹å­è¿›è¡Œè§£è¯»å’Œç¬”è®°, ä»¥æ¶ˆåŒ–æ¯ä¸€ä¸ªçŸ¥è¯†ç»†èŠ‚, æ‰€ä»¥æœ¬æ–‡ä¼šæŒç»­æ›´æ–°, ç›´åˆ°ã€ŠFlex &amp; Bisonã€‹è¯»å®Œ.</p>

<p>å› ä¸ºæœ¬æ–‡åªæ˜¯é’ˆå¯¹æºç ç¨‹åºè¿›è¡Œç®€å•çš„ç¬”è®°å¤‡å¿˜, ä¸ä¼šå®Œå…¨è®²è§£, æ‰€ä»¥ä¸ºäº†å¼„æ‡‚æ¯è¡Œä»£ç , å»ºè®®é˜…è¯»ã€ŠFlex &amp; Bisonã€‹åŸæ–‡.</p>

<h4 id="è¿è¡Œç¯å¢ƒ">è¿è¡Œç¯å¢ƒ:</h4>
<ul>
  <li>Mac 10.13</li>
  <li>flex 2.5.35 Apple(flex-31)</li>
  <li>bison (GNU Bison) 2.3</li>
</ul>

<h4 id="å•è¯ç»Ÿè®¡ç¨‹åº">å•è¯ç»Ÿè®¡ç¨‹åº</h4>
<p>wc.l æºä»£ç :</p>
<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">chars</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">words</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">lines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="o">%</span><span class="p">}</span>

<span class="o">%%</span>
<span class="p">[</span><span class="o">^</span> <span class="err">\</span><span class="n">t</span><span class="err">\</span><span class="n">n</span><span class="err">\</span><span class="n">r</span><span class="err">\</span><span class="n">f</span><span class="err">\</span><span class="n">v</span><span class="p">]</span><span class="o">+</span> <span class="p">{</span> <span class="n">words</span><span class="o">++</span><span class="p">;</span> <span class="n">chars</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">yytext</span><span class="p">);</span> <span class="p">}</span>
<span class="err">\</span><span class="n">n</span>              <span class="p">{</span> <span class="n">chars</span><span class="o">++</span><span class="p">;</span> <span class="n">lines</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span>               <span class="p">{</span> <span class="n">chars</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
<span class="o">%%</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">yylex</span><span class="p">();</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%8d%8d%8d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">chars</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç¼–è¯‘å‘½ä»¤:
<img src="http://localhost:4000/pics/flex-bison/flex-bison-1.png" alt="compile wc.l" /></p>

<p>æºç å¤‡æ³¨:</p>
<ul>
  <li>%{ â€¦ %} æ˜¯ç›´æ¥æ‹·è´åˆ° C æ–‡ä»¶å¼€å¤´</li>
  <li>%% â€¦ %% æ˜¯æ¨¡å¼åŒ¹é…çš„ä»£ç åŒºåŸŸ, å·¦è¾¹æ˜¯æ­£åˆ™è¡¨è¾¾å¼, å³è¾¹æ˜¯åŒ¹é…çš„ C ä»£ç </li>
  <li>yytext ä»£è¡¨åŒ¹é…æ­£åˆ™è¡¨è¾¾å¼çš„å­—ç¬¦ä¸²</li>
  <li>flex çš„åŒ¹é…é»˜è®¤æ˜¯ä»æœ€é•¿åŒ¹é…å¼€å§‹, å¦‚æœæœ‰å¤šä¸ªåŒ¹é…çš„æ­£åˆ™è¡¨è¾¾å¼, ä»æœ€æ—©çš„é‚£ä¸ªå¼€å§‹åŒ¹é…, æ‰€ä»¥ä¸Šé¢çš„æ¨¡å¼åŒ¹é…, é¦–å…ˆæ˜¯æŒ‰ç…§å•è¯ -&gt; è¡Œå°¾ç¬¦ -&gt; å‰©ä½™å­—ç¬¦ä¸²çš„é¡ºåºè¿›è¡ŒåŒ¹é…çš„, ä¸ä¼šäº§ç”Ÿé‡å¤ç»Ÿè®¡çš„é—®é¢˜</li>
  <li>yylex æ˜¯è°ƒç”¨ flex çš„è¯æ³•åˆ†æå‡½æ•° yylex è¿›è¡Œè®¡ç®—</li>
  <li>Linux ç³»ç»Ÿä¸Šç”¨ -lfl é€‰é¡¹ç¼–è¯‘,  Mac çš„ç¼–è¯‘é€‰é¡¹æ˜¯ -ll</li>
</ul>

<h4 id="è‹±ç¾å¼è‹±è¯­è½¬æ¢">è‹±ç¾å¼è‹±è¯­è½¬æ¢</h4>
<p>convert.l æºä»£ç :</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%%</span>
<span class="s">"colour"</span>        <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">"color"</span><span class="p">);</span> <span class="p">}</span>
<span class="s">"flavour"</span>       <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">"flavor"</span><span class="p">);</span> <span class="p">}</span>
<span class="s">"clever"</span>        <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">"smart"</span><span class="p">);</span> <span class="p">}</span>
<span class="s">"conservative"</span>  <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">"libreal"</span><span class="p">);</span> <span class="p">}</span>
<span class="p">.</span>               <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">"%s"</span><span class="p">,</span> <span class="n">yytext</span><span class="p">);</span> <span class="p">}</span>
<span class="o">%%</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">yylex</span><span class="p">();</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç¼–è¯‘å‘½ä»¤:
<img src="http://localhost:4000/pics/flex-bison/flex-bison-2.png" alt="compile convert.l" /></p>

<p>æºç å¤‡æ³¨:</p>
<ul>
  <li>åŒ¹é…è‹±å¼å•è¯å, è½¬æ¢ç§°æ¨¡å¼åçš„ç¾å¼è‹±è¯­</li>
  <li>æœ€åçš„ç‚¹è¡¨ç¤ºä¸è½¬æ¢å•è¯</li>
</ul>

<h4 id="è®¡ç®—å™¨">è®¡ç®—å™¨</h4>
<p>calculator.y</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="p">{</span>
<span class="cp">#define YYSTYPE double
#include&lt;stdio.h&gt;
#include&lt;math.h&gt;
</span><span class="kt">int</span> <span class="n">yylex</span><span class="p">();</span>
<span class="kt">void</span> <span class="n">yyerror</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">);</span>
<span class="o">%</span><span class="p">}</span>

<span class="o">%</span><span class="n">token</span> <span class="n">NUMBER</span>
<span class="o">%</span><span class="n">token</span> <span class="n">ADD</span> <span class="n">SUB</span> <span class="n">MUL</span> <span class="n">DIV</span> <span class="n">ABS</span>
<span class="o">%</span><span class="n">token</span> <span class="n">EOL</span>
<span class="o">%</span><span class="n">token</span> <span class="n">OP</span> <span class="n">CP</span>
<span class="o">%</span><span class="n">token</span> <span class="n">POW</span> <span class="n">SQRT</span>

<span class="o">%%</span>
<span class="n">calclist</span><span class="o">:</span>
<span class="o">|</span> <span class="n">calclist</span> <span class="n">exp</span> <span class="n">EOL</span> <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">"= %f</span><span class="se">\n</span><span class="s">&gt;&gt;&gt; "</span><span class="p">,</span> <span class="err">$</span><span class="mi">2</span><span class="p">);</span> <span class="p">}</span>
<span class="o">|</span> <span class="n">calclist</span> <span class="n">EOL</span> <span class="p">{</span> <span class="n">printf</span><span class="p">(</span><span class="s">"&gt;&gt;&gt; "</span><span class="p">);</span> <span class="p">}</span> <span class="cm">/* blank line or a comment */</span>
<span class="p">;</span>

<span class="n">exp</span><span class="o">:</span> <span class="n">factor</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="o">|</span> <span class="n">exp</span> <span class="n">ADD</span> <span class="n">factor</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span> <span class="o">+</span> <span class="err">$</span><span class="mi">3</span><span class="p">;</span> <span class="p">}</span>
<span class="o">|</span> <span class="n">exp</span> <span class="n">SUB</span> <span class="n">factor</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span> <span class="o">-</span> <span class="err">$</span><span class="mi">3</span><span class="p">;</span> <span class="p">}</span>
<span class="p">;</span>

<span class="n">factor</span><span class="o">:</span> <span class="n">another_factor</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span><span class="err">$</span><span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="o">|</span> <span class="n">factor</span> <span class="n">MUL</span> <span class="n">another_factor</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span> <span class="o">*</span> <span class="err">$</span><span class="mi">3</span><span class="p">;</span> <span class="p">}</span>
<span class="o">|</span> <span class="n">factor</span> <span class="n">DIV</span> <span class="n">another_factor</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span> <span class="o">/</span> <span class="err">$</span><span class="mi">3</span><span class="p">;</span> <span class="p">}</span>
<span class="p">;</span>

<span class="n">another_factor</span><span class="o">:</span> <span class="n">term</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="o">|</span> <span class="n">SUB</span> <span class="n">another_factor</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="o">-</span><span class="err">$</span><span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="o">|</span> <span class="n">another_factor</span> <span class="n">POW</span> <span class="n">another_factor</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="n">pow</span><span class="p">(</span><span class="err">$</span><span class="mi">1</span><span class="p">,</span><span class="err">$</span><span class="mi">3</span><span class="p">);</span> <span class="p">}</span>
<span class="p">;</span>

<span class="n">term</span><span class="o">:</span> <span class="n">NUMBER</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="err">$</span><span class="mi">1</span><span class="p">;</span> <span class="p">}</span>
<span class="o">|</span> <span class="n">ABS</span> <span class="n">exp</span> <span class="n">ABS</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="n">fabs</span><span class="p">(</span><span class="err">$</span><span class="mi">2</span><span class="p">);</span> <span class="p">}</span>
<span class="o">|</span> <span class="n">OP</span> <span class="n">exp</span> <span class="n">CP</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="err">$</span><span class="mi">2</span><span class="p">;</span> <span class="p">}</span>
<span class="o">|</span> <span class="n">SQRT</span> <span class="n">OP</span> <span class="n">exp</span> <span class="n">CP</span> <span class="p">{</span> <span class="err">$$</span> <span class="o">=</span> <span class="n">sqrt</span><span class="p">(</span><span class="err">$</span><span class="mi">3</span><span class="p">);</span> <span class="p">}</span>
<span class="p">;</span>
<span class="o">%%</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"&gt;&gt;&gt; "</span><span class="p">);</span>
    <span class="n">yyparse</span><span class="p">();</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">yyerror</span><span class="p">(</span><span class="kt">char</span> <span class="o">*</span><span class="n">s</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">fprintf</span><span class="p">(</span><span class="n">stderr</span><span class="p">,</span><span class="s">"error : %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span><span class="n">s</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>calculator.l</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="p">{</span>
<span class="cp">#define YYSTYPE double
#include "calculator.tab.h"
#include &lt;stdlib.h&gt;
</span><span class="n">YYSTYPE</span> <span class="n">yylval</span><span class="p">;</span>
<span class="o">%</span><span class="p">}</span>

<span class="o">%%</span>
<span class="s">"+"</span>                             <span class="p">{</span> <span class="k">return</span> <span class="n">ADD</span><span class="p">;</span> <span class="p">}</span>
<span class="s">"-"</span>                             <span class="p">{</span> <span class="k">return</span> <span class="n">SUB</span><span class="p">;</span> <span class="p">}</span>
<span class="s">"*"</span>                             <span class="p">{</span> <span class="k">return</span> <span class="n">MUL</span><span class="p">;</span> <span class="p">}</span>
<span class="s">"/"</span>                             <span class="p">{</span> <span class="k">return</span> <span class="n">DIV</span><span class="p">;</span> <span class="p">}</span>
<span class="s">"|"</span>                             <span class="p">{</span> <span class="k">return</span> <span class="n">ABS</span><span class="p">;</span> <span class="p">}</span>
<span class="s">"("</span>                             <span class="p">{</span> <span class="k">return</span> <span class="n">OP</span><span class="p">;</span> <span class="p">}</span>
<span class="s">")"</span>                             <span class="p">{</span> <span class="k">return</span> <span class="n">CP</span><span class="p">;</span> <span class="p">}</span>
<span class="p">([</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">*</span><span class="err">\</span><span class="p">.</span><span class="o">?</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+|</span><span class="p">[</span><span class="mi">0</span><span class="o">-</span><span class="mi">9</span><span class="p">]</span><span class="o">+</span><span class="err">\</span><span class="p">.)</span>      <span class="p">{</span> <span class="n">yylval</span> <span class="o">=</span> <span class="n">atof</span><span class="p">(</span><span class="n">yytext</span><span class="p">);</span> <span class="k">return</span> <span class="n">NUMBER</span><span class="p">;}</span>
<span class="s">"sqrt"</span>                          <span class="p">{</span> <span class="k">return</span> <span class="n">SQRT</span><span class="p">;</span> <span class="p">}</span>
<span class="s">"**"</span>                            <span class="p">{</span> <span class="k">return</span> <span class="n">POW</span><span class="p">;</span> <span class="p">}</span>
<span class="err">\</span><span class="n">n</span>                              <span class="p">{</span> <span class="k">return</span> <span class="n">EOL</span><span class="p">;</span> <span class="p">}</span>
<span class="p">[</span> <span class="err">\</span><span class="n">t</span><span class="p">]</span>                           <span class="p">{}</span>
<span class="s">"//"</span><span class="p">.</span><span class="o">*</span>                          <span class="p">{}</span>
<span class="o">%%</span>
</code></pre></div></div>

<p>ç¼–è¯‘å‘½ä»¤:
<img src="http://localhost:4000/pics/flex-bison/flex-bison-3.png" alt="compile calculator" /></p>

<p>æºç å¤‡æ³¨:</p>
<ul>
  <li><code class="highlighter-rouge">#define YYSTYPE double</code> è¦æ”¾åœ¨é¡¶éƒ¨, è¿™æ ·å°±å¯ä»¥æŠŠé»˜è®¤çš„ YYSTYPE ä» int æ”¹æˆ double æ¥æ”¯æŒæµ®ç‚¹æ•°è¿ç®—</li>
  <li>calculator.y é¡¶éƒ¨å®šä¹‰å‡½æ•° yylex å’Œ yyerror çš„å£°æ˜, é¿å… cc ç¼–è¯‘çš„æ—¶å€™æŠ¥è­¦å‘Š</li>
  <li>calculator.l æ¨¡å¼ä¸­, åªè¦ { â€¦ } æ˜¯ç©ºç™½å°±è¡¨ç¤ºä¸å¤„ç†æ ‡è®° (token) , ä¹Ÿå°±å¯ä»¥å®ç°å¿½ç•¥ç©ºæ ¼å’Œæ³¨é‡Šå­—ç¬¦ä¸²çš„åŠŸèƒ½</li>
  <li>calculator.y ä¸­è¶Šé ä¸‹çš„åŒ¹é…è§„åˆ™åœ¨è¯­æ³•æ ‘çš„ä¼˜å…ˆçº§è¶Šé«˜, å› ä¸ºå®ƒè¢«åˆ«äººåº”ç”¨çš„è¶Šå¤š, åœ¨è¯­æ³•æ ‘ä¸­è¶Šé è¿‘æ ‘æçš„éƒ¨ä½</li>
</ul>

<h4 id="flex-çš„æ­£åˆ™è¡¨è¾¾å¼">Flex çš„æ­£åˆ™è¡¨è¾¾å¼</h4>
<p>Flex æœ‰å‡ ä¸ªæ­£åˆ™è¡¨è¾¾å¼å’Œä¼ ç»Ÿçš„æ­£åˆ™è¡¨è¾¾å¼è§„åˆ™è¿˜æ˜¯æœ‰ç‚¹åŒºåˆ«:</p>
<ul>
  <li>[a-z]{}[jv] è¡¨ç¤º a-z é‡Œé¢å†æ’é™¤ j å’Œ v</li>
  <li>/ å°¾éƒ¨ä¸Šä¸‹æ–‡, 0/1 è¡¨ç¤ºåŒ¹é… 01 ä¸­çš„ 0 , / åé¢çš„åªç”¨äºå°¾éƒ¨æ¨¡å¼åŒ¹é…, åŒ¹é…å‡ºæ¥çš„æ˜¯æ–œçº¿å‰é¢çš„å†…å®¹, ä½†æ–œçº¿åé¢çš„å†…å®¹å¹¶ä¸ä¼šæ¶ˆè€—æ‰, ä¼šç»§ç»­ç»™ä½™ä¸‹çš„è§„åˆ™åŒ¹é…</li>
</ul>

<h4 id="ç»Ÿè®¡æ–‡ä»¶ä¸­çš„å•è¯æ•°">ç»Ÿè®¡æ–‡ä»¶ä¸­çš„å•è¯æ•°</h4>
<p>wc-file.l æºä»£ç :</p>

<div class="language-c highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">%</span><span class="n">option</span> <span class="n">noyywrap</span>

<span class="o">%</span><span class="p">{</span>
    <span class="kt">int</span> <span class="n">chars</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">words</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">lines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>

    <span class="kt">int</span> <span class="n">totchars</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">totwords</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="kt">int</span> <span class="n">totlines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="o">%</span><span class="p">}</span>

<span class="o">%%</span>
<span class="p">[</span><span class="n">a</span><span class="o">-</span><span class="n">zA</span><span class="o">-</span><span class="n">Z</span><span class="p">]</span><span class="o">+</span>       <span class="p">{</span> <span class="n">words</span><span class="o">++</span><span class="p">;</span> <span class="n">chars</span> <span class="o">+=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">yytext</span><span class="p">);</span> <span class="p">}</span>
<span class="err">\</span><span class="n">n</span>              <span class="p">{</span> <span class="n">chars</span><span class="o">++</span><span class="p">;</span> <span class="n">lines</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
<span class="p">.</span>               <span class="p">{</span> <span class="n">chars</span><span class="o">++</span><span class="p">;</span> <span class="p">}</span>
<span class="o">%%</span>

<span class="kt">int</span> <span class="n">main</span><span class="p">(</span><span class="kt">int</span> <span class="n">argc</span><span class="p">,</span> <span class="kt">char</span> <span class="o">**</span><span class="n">argv</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">printf</span><span class="p">(</span><span class="s">"%8s%8s%8s%8s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="s">"lines"</span><span class="p">,</span> <span class="s">"words"</span><span class="p">,</span> <span class="s">"chars"</span><span class="p">,</span> <span class="s">"file"</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">yylex</span><span class="p">();</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%8d%8d%8d</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">chars</span><span class="p">);</span>
        <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">for</span> <span class="p">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">argc</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">FILE</span> <span class="o">*</span><span class="n">f</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="s">"r"</span><span class="p">);</span>

        <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">f</span><span class="p">)</span> <span class="p">{</span>
            <span class="n">perror</span><span class="p">(</span><span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
            <span class="k">return</span> <span class="mi">1</span><span class="p">;</span>
        <span class="p">}</span>

        <span class="n">yyrestart</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>
        <span class="n">yylex</span><span class="p">();</span>
        <span class="n">fclose</span><span class="p">(</span><span class="n">f</span><span class="p">);</span>

        <span class="n">printf</span><span class="p">(</span><span class="s">"%8d%8d%8d %s</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">lines</span><span class="p">,</span> <span class="n">words</span><span class="p">,</span> <span class="n">chars</span><span class="p">,</span> <span class="n">argv</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>

        <span class="n">totchars</span> <span class="o">+=</span> <span class="n">chars</span><span class="p">;</span> <span class="n">chars</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">totwords</span> <span class="o">+=</span> <span class="n">words</span><span class="p">;</span> <span class="n">words</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="n">totlines</span> <span class="o">+=</span> <span class="n">lines</span><span class="p">;</span> <span class="n">lines</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">argc</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">printf</span><span class="p">(</span><span class="s">"%8d%8d%8d total</span><span class="se">\n</span><span class="s">"</span><span class="p">,</span> <span class="n">totlines</span><span class="p">,</span> <span class="n">totwords</span><span class="p">,</span> <span class="n">totchars</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>

<p>ç¼–è¯‘å‘½ä»¤:
<img src="http://localhost:4000/pics/flex-bison/flex-bison-4.png" alt="compile wc-file.l" /></p>

<p>é˜…è¯»ç¬”è®°:</p>
<ul>
  <li>%option noyywrap æ˜¯ç”¨äºå…³é—­ yywrap è¿™ä¸ªé¸¡è‚‹çš„å‡½æ•°, yywrap ä¸»è¦ç”¨äºè°ƒæ•´ yyin çš„å€¼æ¥è¯»å–æ–°æ–‡ä»¶çš„å†…å®¹</li>
  <li>yyrestart(f) æ”¾åœ¨ yylex ä¹‹å‰, å‘Šè¯‰ flex è¯»å–æ–‡ä»¶ f çš„å†…å®¹</li>
</ul>
:ET