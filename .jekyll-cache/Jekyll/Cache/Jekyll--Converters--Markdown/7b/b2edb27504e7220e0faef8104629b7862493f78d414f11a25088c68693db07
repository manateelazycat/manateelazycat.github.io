I"Ç<p>åšä¸ºä¸€ä¸ªèµ„æ·±çš„Emacså…šï¼ŒæœŸæœ›æ¯ä»¶äº‹æƒ…éƒ½ç”¨Emacsæ¥æå®šï¼ŒåŒæ—¶åšä¸ºä¸­å›½äººï¼Œè¾“å…¥ä¸­æ–‡çœŸçš„æ˜¯åˆšéœ€ã€‚
è€Œ<a href="https://github.com/tumashu/pyim">pyim</a>å°±æ˜¯ä¸€ä¸ªéå¸¸ç‰›é€¼çš„ä¸­æ–‡è¾“å…¥æ³•æ¡†æ¶ã€‚</p>

<p>è™½ç„¶æ·±çˆ±ç€Emacsï¼Œå³ä½¿pyimå†…ç½®äº†è¯åº“ï¼Œpyimåœ¨å¾ˆå¤šæ—¶å€™è¿˜æ˜¯æ— æ³•æ»¡è¶³é•¿å¥è¾“å…¥çš„éœ€æ±‚ï¼Œå¶å°”è¿˜æ˜¯è¦åˆ‡æ¢åˆ°å¤–éƒ¨çš„è¾“å…¥æ³•è¾“å…¥ä¸­æ–‡ï¼Œæ¯”å¦‚å†™è¿™ç¯‡åšå®¢çš„æ—¶å€™ã€‚ä½†æ˜¯å¤–éƒ¨è¾“å…¥æ³•æœ€å¤§çš„é—®é¢˜æ˜¯ä¸çŸ¥é“Emacsçš„è¾“å…¥çŠ¶æ€ï¼Œæ‰€ä»¥ç»å¸¸éœ€è¦æ¥å›åˆ‡æ¢è¾“å…¥æ³•çŠ¶æ€ï¼Œéå¸¸ä¸çˆ½ã€‚</p>

<p>å‡ ä¸ªæœˆå‰çŸ¥é“pyimå¯ä»¥ç›´æ¥è°ƒç”¨RIMEè¾“å…¥æ³•åšä¸ºåç«¯è¿›è¡Œè¾“å…¥ï¼Œé‚£æ—¶å€™pyimæ‰æŠŠLinuxå¹³å°æå®šï¼Œè‡ªå·±è¿™æ®µæ—¶é—´ä¸€ç›´ç”¨Macï¼Œæ‰€ä»¥åªèƒ½çœ¼é¦‹çš„ä»½ï¼Œä»Šå¤©æŠ˜è…¾äº†ä¸€ä¸‹ç»ˆäºæå®šäº†Macä¸‹è®©pyimä½¿ç”¨RIMEè¾“å…¥æ³•ï¼Œå‘æ¯”è¾ƒå¤šï¼Œæ•…å†™ä¸‹æ­¤æ–‡ï¼Œå¸®åŠ©Macç‰ˆçš„Emacsç”¨æˆ·ã€‚</p>

<p>å…ˆä¸Šä¸€å¼ åŠ¨æ€æ•ˆæœå›¾ï¼Œå¢å¼ºä½ å…‹æœå›°éš¾çš„å†³å¿ƒï¼Œå“ˆå“ˆå“ˆå“ˆ:</p>

<p><img src="http://localhost:4000/pics/pyim/rime.gif" alt="pyim-and-rime" /></p>

<h3 id="1-æ›´æ–°pyimå’Œposframeåˆ°æœ€æ–°ç‰ˆ">1 æ›´æ–°pyimå’Œposframeåˆ°æœ€æ–°ç‰ˆ</h3>
<p>ä¸ºäº†æ”¯æŒRIMEè¾“å…¥æ³•éœ€è¦æŠŠ <a href="https://github.com/tumashu/pyim">pyim</a> å’Œ <a href="https://github.com/tumashu/posframe">posframe</a>è¿™ä¸¤ä¸ªåº“æ›´æ–°åˆ°æœ€æ–°ï¼Œå¦åˆ™æœ‰å¯èƒ½ä¼šæŠ¥posframeçš„é”™è¯¯</p>

<h3 id="2-å®‰è£…rimeè¾“å…¥æ³•">2 å®‰è£…RIMEè¾“å…¥æ³•</h3>
<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>brew cask <span class="nb">install </span>squirrel
</code></pre></div></div>

<h3 id="3-ä¸‹è½½librimeæºç ">3 ä¸‹è½½librimeæºç </h3>
<p>ä¸‹è½½librimeæºç :</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone <span class="nt">--recursive</span> https://github.com/rime/librime.git <span class="nt">--depth</span><span class="o">=</span>1
</code></pre></div></div>

<h3 id="4-ç¼–è¯‘liberime">4 ç¼–è¯‘liberime</h3>

<ul>
  <li>4.1 ä¸‹è½½liberimeæºç </li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>git clone https://gitlab.com/liberime/liberime.git <span class="nt">--depth</span><span class="o">=</span>1
</code></pre></div></div>

<ul>
  <li>4.2 åˆ›å»ºlibrime xbuildç›®å½•</li>
</ul>

<p>å› ä¸ºliberimeåŠ¨æ€åº“æ˜¯éœ€è¦æ ¹æ®librimeæ¥ç¼–è¯‘çš„ï¼ŒåŒæ—¶RIMEè¾“å…¥æ³•æœ¬èº«å°±å¸¦äº†librime.1.dylibï¼Œæ‰€ä»¥æˆ‘ä»¬å¹¶ä¸éœ€è¦ä¸‹è½½å·¨å¤§æ— æ¯”çš„xcodeå»ç¼–è¯‘librime.1.dylib</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir</span> <span class="nt">-p</span> ~/librime/xbuild/lib/Release/

<span class="nb">cp</span> /Library/Input<span class="se">\ </span>Methods/Squirrel.app/Contents/Frameworks/librime.1.dylib ~/librime/xbuild/lib/Release/librime.dylib
</code></pre></div></div>

<ul>
  <li>4.3 ç¼–è¯‘liberime.soæ–‡ä»¶</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cd</span> ~/liberime

<span class="nb">export </span><span class="nv">RIME_PATH</span><span class="o">=</span>~/librime

make liberime
</code></pre></div></div>
<p>ä¸Šé¢çš„å‘½ä»¤è‡ªåŠ¨ä¼šå» ~/librime/xbuild/lib/Release/ ç›®å½•ä¸‹æ‰¾ librime.dylib æ–‡ä»¶ï¼Œå¹¶åœ¨ ~/liberime/buid/ ç›®å½•ä¸‹ç”Ÿæˆ liberime.so åŠ¨æ€åº“æ–‡ä»¶</p>

<ul>
  <li>4.4 æŠŠ librime.1.dylib æ–‡ä»¶æ‹·è´åˆ°ç³»ç»Ÿlibç›®å½•</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo cp</span> /Library/Input<span class="se">\ </span>Methods/Squirrel.app/Contents/Frameworks/librime.1.dylib /usr/local/lib
</code></pre></div></div>

<p>å¦åˆ™åé¢ (require â€˜liberime) çš„æ—¶å€™ä¼šä¸‹é¢çš„é”™è¯¯</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>dyld: Library not loaded: @rpath/librime.1.dylib
  Referenced from: ...
  Reason: image not found
</code></pre></div></div>

<h3 id="5-é…ç½®pyim">5 é…ç½®pyim</h3>
<p>æ‹·è´ liberime.so æ–‡ä»¶åˆ° ~/.emacs.d/ ç›®å½•ä¸‹ï¼Œç„¶ååœ¨ ~/.emacs å†™ä¸‹å¦‚ä¸‹é…ç½®å³å¯:</p>

<div class="language-elisp highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">(</span><span class="k">setq</span> <span class="nv">load-path</span> <span class="p">(</span><span class="nb">cons</span> <span class="p">(</span><span class="nv">file-truename</span> <span class="s">"~/.emacs.d/"</span><span class="p">)</span> <span class="nv">load-path</span><span class="p">))</span>

<span class="p">(</span><span class="nb">require</span> <span class="ss">'pyim</span><span class="p">)</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">'posframe</span><span class="p">)</span>
<span class="p">(</span><span class="nb">require</span> <span class="ss">'liberime</span><span class="p">)</span>

<span class="p">(</span><span class="k">setq</span> <span class="nv">default-input-method</span> <span class="s">"pyim"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">pyim-page-tooltip</span> <span class="ss">'posframe</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">pyim-page-length</span> <span class="mi">9</span><span class="p">)</span>

<span class="p">(</span><span class="nv">liberime-start</span> <span class="s">"/Library/Input Methods/Squirrel.app/Contents/SharedSupport"</span> <span class="p">(</span><span class="nv">file-truename</span> <span class="s">"~/.emacs.d/pyim/rime/"</span><span class="p">))</span>
<span class="p">(</span><span class="nv">liberime-select-schema</span> <span class="s">"luna_pinyin_simp"</span><span class="p">)</span>
<span class="p">(</span><span class="k">setq</span> <span class="nv">pyim-default-scheme</span> <span class="ss">'rime-quanpin</span><span class="p">)</span>
</code></pre></div></div>

<h3 id="6-å¢åŠ rimeå€™é€‰è¯æ•°é‡">6 å¢åŠ RIMEå€™é€‰è¯æ•°é‡</h3>

<p>liberimeé»˜è®¤åªèƒ½è·å–5ä¸ªåé€‰è¯ï¼Œç”¨ä¸‹é¢çš„æ–¹æ³•å¯ä»¥å¢åŠ RIMEåç«¯æ—¶çš„åé€‰è¯æ•°é‡ã€‚</p>

<p>åˆ›å»º ~/.emacs.d/pyim/rime/default.custom.yaml æ–‡ä»¶ï¼Œå†…å®¹å¦‚ä¸‹ï¼š</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>patch:
     <span class="s2">"menu/page_size"</span>: 100
     <span class="s2">"speller/auto_select"</span>: <span class="nb">false</span>
     <span class="s2">"speller/auto_select_unique_candidate"</span>: <span class="nb">false</span>
</code></pre></div></div>

<h2 id="æœ€å">æœ€å</h2>
<p>ä¸Šé¢è¿™ä¹ˆé•¿ä¸€ç¯‡çš„æ–‡å­—éƒ½æ˜¯æˆ‘åœ¨Emacsä¸‹ç”¨pyimé…åˆRIMEåç«¯æ¥è¿›è¡Œè¾“å…¥çš„ï¼Œæ•´ä¸ªè¿‡ç¨‹éå¸¸æµç•…ï¼Œé•¿å¥è¾“å…¥ä¹Ÿéå¸¸éå¸¸çš„èµã€‚</p>

<p>ç»ˆäºä¸ç”¨åœ¨Emacsä¸­ä½¿ç”¨å¤–éƒ¨è¾“å…¥æ³•äº†ï¼Œå“ˆå“ˆå“ˆå“ˆã€‚</p>

<p>Linuxç‰ˆçš„å®‰è£…æ–¹æ³•å¯ä»¥çœ‹æˆ‘çš„å¦å¤–ä¸€ç¯‡æ–‡ç« <a href="https://manateelazycat.github.io/emacs/2019/09/12/make-rime-in-emacs.html">Â«åœ¨Linuxç‰ˆçš„Emacsä¸­ä½¿ç”¨RIMEè¾“å…¥æ³•Â»</a></p>
:ET