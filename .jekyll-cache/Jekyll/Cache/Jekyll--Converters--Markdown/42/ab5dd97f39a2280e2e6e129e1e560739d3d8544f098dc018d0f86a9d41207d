I"İÒ<h1 id="ä¸ºä»€ä¹ˆè¦é‡æ–°é€ ä¸€ä¸ªlistviewæ§ä»¶">ä¸ºä»€ä¹ˆè¦é‡æ–°é€ ä¸€ä¸ªListViewæ§ä»¶ï¼Ÿ</h1>
<p>åœ¨å¼€å‘åº”ç”¨ç¨‹åºçš„è¿‡ç¨‹ä¸­ï¼Œç»å¸¸ä¼šä½¿ç”¨åˆ°åˆ—è¡¨æ¥å±•ç°å†…å®¹ï¼ˆæ¯”å¦‚éŸ³ä¹æ’­æ”¾å™¨çš„æ’­æ”¾åˆ—è¡¨å’Œç³»ç»Ÿç›‘è§†å™¨çš„è¿›ç¨‹åˆ—è¡¨ï¼‰ï¼Œè€Œåˆ¶ä½œåˆ—è¡¨å†…å®¹ä¸èƒ½åƒä¼ ç»Ÿçš„VBoxLayoutæ¥æ·»åŠ å­æ§ä»¶ï¼Œå› ä¸ºæ¯ä¸ªå­æ§ä»¶éƒ½ä»£è¡¨ä¸€ä¸ª XWindowï¼Œ å½“æˆç™¾ä¸Šåƒçš„å­æ§ä»¶å †ç Œåœ¨ä¸€èµ·çš„æ—¶å€™å°±ä¼šé€ æˆå·¨å¤§çš„æ€§èƒ½ç“¶é¢ˆã€‚</p>

<p>å¼€å‘äº†å¾ˆå¤šGtk+å’ŒQtçš„ç¨‹åºï¼Œå¯¹äºGtk+å’ŒQtå†…ç½®çš„ListViewçš„æ§ä»¶æ˜“ç”¨æ€§éå¸¸ä¸æ»¡æ„ï¼Œå› ä¸ºå½“å¼€å‘è€…åˆæ¬¡å­¦ä¹ è¿™äº›æ§ä»¶æ—¶ï¼Œä¼šè¢«Gtk+/Qtçš„MVCæ¨¡å‹å’Œå„ç§APIç»•æ™•ï¼Œä¸æ˜¯è¯´MVCçš„æ¨¡å‹ä¸å®¹æ˜“ç†è§£ï¼Œè€Œæ˜¯åœ¨ç†è§£MVCæ¨¡å‹åï¼Œè¦é€šè¿‡æŸ¥çœ‹APIå°±å¯ä»¥å¿«é€Ÿå¼€å‘å‡ºç¬¦åˆäº§å“è¦æ±‚çš„ListViewéå¸¸éå¸¸çš„å›°éš¾ï¼Œç»å¸¸è¦çœ‹ç°æœ‰çš„ä¾‹å­ï¼Œç„¶åæŠŠæ‰€æœ‰æ¥å£çš„ç»†èŠ‚éƒ½å°å¿ƒç¿¼ç¿¼çš„ç»„è£…æ‰èƒ½æ­£å¸¸å·¥ä½œï¼Œå› ä¸ºGtk+/Qtçš„ListViewçš„APIè®¾è®¡çš„éå¸¸å¤æ‚ï¼Œå¦‚æœæ¯ä¸€è¡Œè¿˜æ˜¯å¤æ‚çš„è‡ªå®šä¹‰æ¸²æŸ“å†…å®¹æ—¶ï¼Œå®ç°ä¼šæ›´åŠ å¤æ‚éš¾æ‡‚ã€‚</p>

<p>æ‰€ä»¥ï¼Œæˆ‘åœ¨å†™æ·±åº¦ç³»ç»Ÿç›‘è§†å™¨çš„æ—¶å€™ï¼Œå¤§éƒ¨åˆ†çš„å·¥ä½œéƒ½åœ¨åˆ›é€  DTK Simple ListView, å¸Œæœ›ListViewåœ¨è®¾è®¡ä¸Šä¸ä½†è¦æ»¡è¶³æé«˜çš„æ¸²æŸ“æ€§èƒ½ï¼Œè¿˜è¦èƒ½å¤Ÿç»˜åˆ¶å„ç§å¤æ‚çš„è‡ªç»˜å†…å®¹ï¼Œæœ€åè¦æ±‚åˆ›é€ æ§ä»¶çš„å¼€å‘éš¾åº¦é™åˆ°æœ€ä½ï¼Œåšåˆ°ä¸€çœ‹å°±æ‡‚ï¼Œä¸€é€šç™¾é€šã€‚</p>

<h1 id="dtk-simple-listview-è®¾è®¡ç†å¿µ">DTK Simple ListView è®¾è®¡ç†å¿µ</h1>
<p>DTK Simple ListViewçš„è®¾è®¡ç†å¿µæ˜¯ï¼ŒMVæ¨¡å‹ï¼š</p>
<ul>
  <li>DSimpleListView æä¾›åˆ—è¡¨è¡Œé«˜åº¦å’Œåˆ—å®½åº¦çš„æ§åˆ¶ã€åˆ—è¡¨æ»šåŠ¨ä½ç½®å’Œé€‰æ‹©çŠ¶æ€çš„ç»´æŠ¤å’Œä¼ é€’ QPainter ç»™ DSimpleListItem, DSimpleListView æœ¬èº«ä¸è¿›è¡Œä»»ä½•è¡Œå†…å®¹çš„ç»˜åˆ¶ï¼Œå®ƒåªæ˜¯æŠŠæ‰€æœ‰ DSimpleListItem ç»˜åˆ¶çš„å†…å®¹æ•´åˆåœ¨ä¸€èµ·è¿›è¡Œç®¡ç†</li>
  <li>DSimpleListItem å¾—åˆ° DSimpleListView ä¼ é€’è¿‡æ¥çš„ QPainterã€åˆ—ä¿¡æ¯ã€è¡¨æ ¼çŸ©å½¢æ•°æ®åï¼Œç”±å¼€å‘è€…å®Œå…¨æ§åˆ¶è¡Œå†…å®¹çš„ç»˜åˆ¶</li>
</ul>

<p>è¿™æ ·è®¾è®¡çš„å¥½å¤„æ˜¯ï¼Œå¼€å‘è€…åªè¦æ‡‚å¾—æ€ä¹ˆä½¿ç”¨ QPainter è¿›è¡Œå›¾å½¢ç»˜åˆ¶ï¼Œå¼€å‘è€…å°±å¯ä»¥åœ¨ DSimpleListItem ä¸­ç»˜åˆ¶ä»»æ„è¡Œå†…å®¹ï¼ŒåŒ…æ‹¬æ–‡æœ¬ã€å›¾ç‰‡ã€ä»»æ„æ§ä»¶ç”šè‡³æ¯è¡Œéƒ½å¯ä»¥ç”»ä¸€ä¸ªå°ç”µå½±ï¼Œè€Œä»£ç çš„å¤æ‚åº¦ä¸ä¼šéšç€ç»˜åˆ¶è¡Œå†…å®¹è€Œå‘ç”Ÿå˜åŒ–ï¼Œæ‰€æœ‰çš„è¡Œå†…å®¹éƒ½æºäºæ€ä¹ˆä½¿ç”¨ QPainterã€‚</p>

<p>ä¸€æ—¦ç†è§£äº†DSimpleListView/DSimpleItemçš„è®¾è®¡ç†å¿µï¼Œçœ‹äº†ä¸¤ä¸ªå°ä¾‹å­ï¼Œä»»ä½•å¤æ‚çš„äº§å“åˆ—è¡¨éœ€æ±‚éƒ½å¯ä»¥å¿«é€Ÿæ»¡è¶³ã€‚</p>

<h1 id="å®‰è£…å¼€å‘ç‰ˆæœ¬-dtk">å®‰è£…å¼€å‘ç‰ˆæœ¬ DTK</h1>
<p>åœ¨è®²è§£ä»£ç ç”¨ä¾‹ä¹‹å‰ï¼Œéœ€è¦å…ˆå®‰è£… DTK å¼€å‘ç‰ˆæœ¬ï¼ŒDeepinç”¨æˆ·å¯ä»¥ç›´æ¥ä» <a href="https://ci.deepin.io/job/dtkwidget-ci/">DTK DebåŒ…</a> ä¸‹è½½ libdtkwidget-dev_.deb å’Œ libdtkwidget2_.deb ä¸¤ä¸ªåŒ…ã€‚</p>

<p>å…¶ä»–Linuxå‘è¡Œç‰ˆçš„å¼€å‘è€…éœ€è¦è‡ªè¡Œä»æºç è¿›è¡Œç¼–è¯‘: <a href="https://github.com/linuxdeepin/dtkwidget/blob/master/README.md">DTKæºç ç¼–è¯‘æ‰‹å†Œ</a></p>

<h1 id="dtk-simple-listview-ç”¨ä¾‹è®²è§£">DTK Simple ListView ç”¨ä¾‹è®²è§£</h1>
<h3 id="å•åˆ—åˆ—è¡¨">å•åˆ—åˆ—è¡¨</h3>
<p>å…¥é—¨ä¾‹å­ï¼šåšä¸€ä¸ªæœ€ç®€å•çš„ä¾‹å­ï¼Œæ˜¾ç¤ºåªæœ‰ä¸€åˆ—çš„æ–‡æœ¬ã€‚</p>

<p>é¦–å…ˆï¼Œå¾—åŸºäº DSimpleListView/DSimpleListItem åˆ›å»ºä¸¤ä¸ªå­ç±»ï¼Œ ListViewå¾ˆç®€å•ï¼Œç›´æ¥ç»§æ‰¿ DSimpleListView å°±å¯ä»¥äº†ï¼Œ ListItem åªè¦å®ç°ä¸‰ä¸ªéå¸¸ç®€å•çš„æ¥å£å‡½æ•° (sameAs, drawBackground, drawForeground)å³å¯:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// singlelistview.h</span>
<span class="cp">#ifndef SINGLELISTVIEW_H
#define SINGLELISTVIEW_H
</span>
<span class="cp">#include &lt;DSimpleListView&gt;
</span>
<span class="n">DWIDGET_USE_NAMESPACE</span>  <span class="c1">// è¿™å¥è¯ä¸»è¦å¼ºè°ƒä½¿ç”¨ dtkwidget çš„å‘½åç©ºé—´ï¼Œä»¥ä½¿ç”¨å…¶æ§ä»¶</span>

<span class="k">class</span> <span class="nc">SingleListView</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DSimpleListView</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">SingleListView</span><span class="p">(</span><span class="n">DSimpleListView</span> <span class="o">*</span><span class="n">parent</span><span class="o">=</span><span class="mi">0</span><span class="p">);</span>
<span class="p">};</span>

<span class="cp">#endif
</span>
<span class="c1">// singlelistitem.h</span>
<span class="cp">#ifndef SINGLELISTITEM_H
#define SINGLELISTITEM_H
</span>
<span class="cp">#include &lt;DSimpleListItem&gt;
</span>
<span class="n">DWIDGET_USE_NAMESPACE</span>

<span class="k">class</span> <span class="nc">SingleListItem</span> <span class="o">:</span> <span class="k">public</span> <span class="n">DSimpleListItem</span>
<span class="p">{</span>
    <span class="n">Q_OBJECT</span>

<span class="k">public</span><span class="o">:</span>
    <span class="n">SingleListItem</span><span class="p">(</span><span class="n">QString</span> <span class="n">itemName</span><span class="p">);</span>

    <span class="c1">// DSimpleListItem æ¥å£å‡½æ•°ï¼Œç”¨äºåŒºåˆ†ä¸¤ä¸ªItemæ˜¯å¦æ˜¯åŒä¸€ä¸ªItem?</span>
    <span class="kt">bool</span> <span class="n">sameAs</span><span class="p">(</span><span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item</span><span class="p">);</span>

    <span class="c1">// ç»˜åˆ¶ItemèƒŒæ™¯çš„æ¥å£å‡½æ•°ï¼Œå‚æ•°ä¾æ¬¡ä¸ºè¡¨æ ¼çŸ©å½¢ã€ç»˜åˆ¶QPainterå¯¹è±¡ã€è¡Œç´¢å¼•ã€å½“å‰è¡Œæ˜¯å¦é€‰ä¸­ï¼Ÿ</span>
    <span class="kt">void</span> <span class="n">drawBackground</span><span class="p">(</span><span class="n">QRect</span> <span class="n">rect</span><span class="p">,</span> <span class="n">QPainter</span> <span class="o">*</span><span class="n">painter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSelect</span><span class="p">);</span>

    <span class="c1">// ç»˜åˆ¶Itemå‰æ™¯çš„æ¥å£å‡½æ•°ï¼Œå‚æ•°ä¾æ¬¡ä¸ºè¡¨æ ¼çŸ©å½¢ã€ç»˜åˆ¶QPainterå¯¹è±¡ã€è¡Œç´¢å¼•ã€å½“å‰è¡Œæ˜¯å¦é€‰ä¸­ï¼Ÿ</span>
    <span class="kt">void</span> <span class="n">drawForeground</span><span class="p">(</span><span class="n">QRect</span> <span class="n">rect</span><span class="p">,</span> <span class="n">QPainter</span> <span class="o">*</span><span class="n">painter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">column</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSelect</span><span class="p">);</span>

    <span class="c1">// åå­—å±æ€§ï¼Œè¿™é‡Œç”¨äºç»˜åˆ¶æ–‡æœ¬åˆ—çš„å†…å®¹</span>
    <span class="n">QString</span> <span class="n">name</span><span class="p">;</span>
<span class="p">};</span>

<span class="cp">#endif
</span></code></pre></div></div>

<p>å…¶æ¬¡ï¼Œå®ç° singlelistview.cpp, çœ‹çœ‹è¶…çº§ç®€å•å§ï¼Ÿ åªéœ€æ ¹æ® QString åˆ›å»ºä¸€ä¸ª DSimpleListItem ï¼Œç„¶åé€šè¿‡å‡½æ•°æ·»åŠ Itemåˆ°ListViewå³å¯:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// singlelistview.cpp</span>
<span class="cp">#include "singlelistview.h"
#include "singlelistitem.h"
</span>
<span class="n">DWIDGET_USE_NAMESPACE</span>

<span class="n">SingleListView</span><span class="o">::</span><span class="n">SingleListView</span><span class="p">(</span><span class="n">DSimpleListView</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span> <span class="o">:</span> <span class="n">DSimpleListView</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QStringList</span> <span class="n">rockStars</span><span class="p">;</span>
    <span class="n">rockStars</span> <span class="o">&lt;&lt;</span> <span class="s">"Bob Dylan"</span> <span class="o">&lt;&lt;</span> <span class="s">"Neil Young"</span> <span class="o">&lt;&lt;</span> <span class="s">"Eric Clapton"</span> <span class="o">&lt;&lt;</span> <span class="s">"John Lennon"</span><span class="p">;</span>

    <span class="n">QList</span><span class="o">&lt;</span><span class="n">DSimpleListItem</span><span class="o">*&gt;</span> <span class="n">items</span><span class="p">;</span>
    <span class="k">for</span> <span class="p">(</span><span class="k">auto</span> <span class="n">rockStarName</span> <span class="o">:</span> <span class="n">rockStars</span><span class="p">){</span>
        <span class="n">SingleListItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="k">new</span> <span class="n">SingleListItem</span><span class="p">(</span><span class="n">rockStarName</span><span class="p">);</span>
        <span class="n">items</span> <span class="o">&lt;&lt;</span> <span class="n">item</span><span class="p">;</span>
    <span class="p">}</span>

    <span class="n">addItems</span><span class="p">(</span><span class="n">items</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>

<p>DTK Simple ListView è®¾è®¡ç†å¿µæ˜¯ï¼Œå¼€å‘è€…åªéœ€è¦æŠŠæ‰€æœ‰ç²¾åŠ›ä¸“æ³¨äº DSimpleListItem çš„æ¥å£å‡½æ•°ä¸Šï¼Œå°±å¯ä»¥å®ç°ä»»æ„å¤æ‚çš„ç•Œé¢æ•ˆæœï¼Œ DSimpleListView ä¸ç”¨è¿‡å¤šå…³å¿ƒï¼Œå¼€å‘è€…çš„é™„åŠ é—¨æ§›éå¸¸éå¸¸ä½ã€‚</p>

<p>ä¸‹é¢æˆ‘ä»¬å°±çœ‹ä¸€ä¸‹å®ç°ä¸Šå›¾ä¸­çš„å•åˆ—åˆ—è¡¨çš„ DSimpleListItem çš„å®ç°ç»†èŠ‚ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// singlelistitem.cpp</span>
<span class="cp">#include "singlelistitem.h"
#include &lt;QColor&gt;
</span>
<span class="n">DWIDGET_USE_NAMESPACE</span>

<span class="n">SingleListItem</span><span class="o">::</span><span class="n">SingleListItem</span><span class="p">(</span><span class="n">QString</span> <span class="n">itemName</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// åˆå§‹åŒ–æ–‡æœ¬å±æ€§</span>
    <span class="n">name</span> <span class="o">=</span> <span class="n">itemName</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">SingleListItem</span><span class="o">::</span><span class="n">sameAs</span><span class="p">(</span><span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// æ ¹æ®ä¸¤ä¸ªItemçš„å±æ€§æ¥åˆ¤æ–­ä¸¤ä¸ªItemæ˜¯å¦æ˜¯ç›¸åŒçš„ï¼Ÿ</span>
    <span class="c1">// DSimpleListView å†…éƒ¨éƒ½æ˜¯æŒ‰ç…§ DSimpleListItem ç±»å‹æ¥å¤„ç†çš„ï¼ŒsameAS ä¸­éœ€è¦ç”¨ static_cast è¿›è¡Œä¸€ä¸‹ç±»å‹è½¬æ¢</span>
    <span class="k">return</span> <span class="n">name</span> <span class="o">==</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">SingleListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">name</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">SingleListItem</span><span class="o">::</span><span class="n">drawBackground</span><span class="p">(</span><span class="n">QRect</span> <span class="n">rect</span><span class="p">,</span> <span class="n">QPainter</span> <span class="o">*</span><span class="n">painter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSelect</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// åˆå§‹åŒ–ç»˜åˆ¶èƒŒæ™¯æ‰€éœ€çš„è¡ŒçŸ©å½¢å¯¹è±¡</span>
    <span class="n">QPainterPath</span> <span class="n">path</span><span class="p">;</span>
    <span class="n">path</span><span class="p">.</span><span class="n">addRect</span><span class="p">(</span><span class="n">QRectF</span><span class="p">(</span><span class="n">rect</span><span class="p">));</span>

    <span class="c1">// å½“è¡Œé€‰ä¸­æ—¶ç»˜åˆ¶è“è‰²èƒŒæ™¯ï¼Œæ²¡æœ‰é€‰ä¸­æ—¶ç»˜åˆ¶ç°è‰²èƒŒæ™¯</span>
    <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setOpacity</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isSelect</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">fillPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="s">"#2CA7F8"</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">fillPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="s">"#D8D8D8"</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">SingleListItem</span><span class="o">::</span><span class="n">drawForeground</span><span class="p">(</span><span class="n">QRect</span> <span class="n">rect</span><span class="p">,</span> <span class="n">QPainter</span> <span class="o">*</span><span class="n">painter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">column</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSelect</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// å½“è¡Œé€‰ä¸­æ—¶ä½¿ç”¨ç™½è‰²æ–‡å­—ï¼Œæ²¡æœ‰é€‰ä¸­æ—¶ä½¿ç”¨é»‘è‰²æ–‡å­—</span>
    <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setOpacity</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isSelect</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setPen</span><span class="p">(</span><span class="n">QPen</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="s">"#FFFFFF"</span><span class="p">)));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setPen</span><span class="p">(</span><span class="n">QPen</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="s">"#000000"</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="c1">// ç»˜åˆ¶æ–‡å­—ï¼Œå·¦å¯¹é½ï¼Œçºµå‘å±…ä¸­å¯¹é½ï¼Œæ–‡å­—å·¦è¾¹ç•™10åƒç´ çš„ç©ºç™½</span>
    <span class="kt">int</span> <span class="n">padding</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">painter</span><span class="o">-&gt;</span><span class="n">drawText</span><span class="p">(</span><span class="n">QRect</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">padding</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">rect</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="n">padding</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">height</span><span class="p">()),</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignLeft</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignVCenter</span><span class="p">,</span> <span class="n">name</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>
<p>æ˜¯ä¸æ˜¯éå¸¸éå¸¸çš„ç®€å•ï¼Ÿ æœ€ç»ˆæ•ˆæœå›¾å¦‚ä¸‹ï¼š
<img src="http://localhost:4000/pics/dtk/dtk-1.gif" alt="å•åˆ—åˆ—è¡¨" /></p>

<h3 id="å¤šåˆ—åˆ—è¡¨">å¤šåˆ—åˆ—è¡¨</h3>
<p>å¤šåˆ—åˆ—è¡¨çš„åŸç†ä¹Ÿéå¸¸ç®€å•ï¼Œç›´æ¥çœ‹ä»£ç ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// multilistview.cpp</span>
<span class="cp">#include "multilistview.h"
#include "multilistitem.h"
</span>
<span class="n">DWIDGET_USE_NAMESPACE</span>

<span class="n">MultiListView</span><span class="o">::</span><span class="n">MultiListView</span><span class="p">(</span><span class="n">DSimpleListView</span> <span class="o">*</span><span class="n">parent</span><span class="p">)</span> <span class="o">:</span> <span class="n">DSimpleListView</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="n">DSimpleListItem</span><span class="o">*&gt;</span> <span class="n">items</span><span class="p">;</span>
    <span class="n">MultiListItem</span> <span class="o">*</span><span class="n">item1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MultiListItem</span><span class="p">(</span><span class="s">"Bob Dylan"</span><span class="p">,</span> <span class="s">"Like A Rolling Stone"</span><span class="p">,</span> <span class="s">"5:56"</span><span class="p">);</span>
    <span class="n">MultiListItem</span> <span class="o">*</span><span class="n">item2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MultiListItem</span><span class="p">(</span><span class="s">"Neil Young"</span><span class="p">,</span> <span class="s">"Old Man"</span><span class="p">,</span> <span class="s">"4:08"</span><span class="p">);</span>
    <span class="n">MultiListItem</span> <span class="o">*</span><span class="n">item3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MultiListItem</span><span class="p">(</span><span class="s">"Eric Clapton"</span><span class="p">,</span> <span class="s">"Tears In Heaven"</span><span class="p">,</span> <span class="s">"4:34"</span><span class="p">);</span>
    <span class="n">MultiListItem</span> <span class="o">*</span><span class="n">item4</span> <span class="o">=</span> <span class="k">new</span> <span class="n">MultiListItem</span><span class="p">(</span><span class="s">"John Lennon"</span><span class="p">,</span> <span class="s">"Imagine"</span><span class="p">,</span> <span class="s">"3:56"</span><span class="p">);</span>

    <span class="n">items</span> <span class="o">&lt;&lt;</span> <span class="n">item1</span><span class="p">;</span>
    <span class="n">items</span> <span class="o">&lt;&lt;</span> <span class="n">item2</span><span class="p">;</span>
    <span class="n">items</span> <span class="o">&lt;&lt;</span> <span class="n">item3</span><span class="p">;</span>
    <span class="n">items</span> <span class="o">&lt;&lt;</span> <span class="n">item4</span><span class="p">;</span>

    <span class="c1">// åˆå§‹åŒ–æ ‡é¢˜åˆ—çš„åå­—</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="n">QString</span><span class="o">&gt;</span> <span class="n">titles</span><span class="p">;</span>
    <span class="n">titles</span> <span class="o">&lt;&lt;</span> <span class="s">"Artist"</span> <span class="o">&lt;&lt;</span> <span class="s">"Song"</span> <span class="o">&lt;&lt;</span> <span class="s">"Length"</span><span class="p">;</span>

    <span class="c1">// åˆå§‹åŒ–æ¯ä¸€åˆ—çš„å®½åº¦ï¼Œ-1è¡¨ç¤ºå½“å‰åˆ—è‡ªåŠ¨æ’‘å¼€ï¼Œå…¶ä»–æ•°å­—è¡¨ç¤ºå›ºå®šåƒç´ å€¼ï¼Œä¸€ä¸ªåˆ—è¡¨åªå…è®¸æœ‰ä¸€ä¸ªè‡ªåŠ¨æ’‘å¼€çš„åˆ—</span>
    <span class="n">QList</span><span class="o">&lt;</span><span class="kt">int</span><span class="o">&gt;</span> <span class="n">widths</span><span class="p">;</span>
    <span class="n">widths</span> <span class="o">&lt;&lt;</span> <span class="mi">100</span> <span class="o">&lt;&lt;</span> <span class="o">-</span><span class="mi">1</span> <span class="o">&lt;&lt;</span> <span class="mi">20</span><span class="p">;</span>

    <span class="c1">// è®¾ç½®åˆ—è¡¨çš„æ ‡é¢˜ã€å®½åº¦å’Œæ ‡é¢˜æ çš„é«˜åº¦</span>
    <span class="n">setColumnTitleInfo</span><span class="p">(</span><span class="n">titles</span><span class="p">,</span> <span class="n">widths</span><span class="p">,</span> <span class="mi">36</span><span class="p">);</span>

    <span class="n">addItems</span><span class="p">(</span><span class="n">items</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p>å¤šåˆ—çš„ ListView ä¹Ÿéå¸¸ç®€å•ï¼Œå”¯ä¸€å¤šäº† setColumnTitleInfo å‡½æ•°ï¼Œå› ä¸ºåˆ—è¡¨æœ‰å¤šä¸ªåˆ—ï¼Œéœ€è¦å‘Šè¯‰ DSimpleListView æ¯ä¸€åˆ—çš„æ ‡é¢˜ã€å®½åº¦å’Œæœ€ç»ˆæ ‡é¢˜æ çš„é«˜åº¦ï¼Œå¦‚æœä¸æƒ³æ˜¾ç¤ºæ ‡é¢˜æ ï¼Œå¯ä»¥æŠŠæ ‡é¢˜æ çš„é«˜åº¦è®¾ç½®0åƒç´ å³å¯ã€‚</p>

<p>multilistviewitem.cpp çš„å®ç°éå¸¸ç±»ä¼¼å•åˆ—åˆ—è¡¨çš„Itemå®ç°:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// multilistitem.cpp</span>
<span class="cp">#include "multilistitem.h"
#include &lt;QColor&gt;
</span>
<span class="n">DWIDGET_USE_NAMESPACE</span>

<span class="n">MultiListItem</span><span class="o">::</span><span class="n">MultiListItem</span><span class="p">(</span><span class="n">QString</span> <span class="n">artistName</span><span class="p">,</span> <span class="n">QString</span> <span class="n">songName</span><span class="p">,</span> <span class="n">QString</span> <span class="n">songLength</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">artist</span> <span class="o">=</span> <span class="n">artistName</span><span class="p">;</span>
    <span class="n">song</span> <span class="o">=</span> <span class="n">songName</span><span class="p">;</span>
    <span class="n">length</span> <span class="o">=</span> <span class="n">songLength</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">MultiListItem</span><span class="o">::</span><span class="n">sameAs</span><span class="p">(</span><span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">return</span> <span class="n">artist</span> <span class="o">==</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">artist</span> <span class="o">&amp;&amp;</span> <span class="n">song</span> <span class="o">==</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">song</span> <span class="o">&amp;&amp;</span> <span class="n">length</span> <span class="o">==</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">MultiListItem</span><span class="o">::</span><span class="n">drawBackground</span><span class="p">(</span><span class="n">QRect</span> <span class="n">rect</span><span class="p">,</span> <span class="n">QPainter</span> <span class="o">*</span><span class="n">painter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSelect</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">QPainterPath</span> <span class="n">path</span><span class="p">;</span>
    <span class="n">path</span><span class="p">.</span><span class="n">addRect</span><span class="p">(</span><span class="n">QRectF</span><span class="p">(</span><span class="n">rect</span><span class="p">));</span>

    <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setOpacity</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">isSelect</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">fillPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="s">"#2CA7F8"</span><span class="p">));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">index</span> <span class="o">%</span> <span class="mi">2</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">fillPath</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="s">"#D8D8D8"</span><span class="p">));</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kt">void</span> <span class="n">MultiListItem</span><span class="o">::</span><span class="n">drawForeground</span><span class="p">(</span><span class="n">QRect</span> <span class="n">rect</span><span class="p">,</span> <span class="n">QPainter</span> <span class="o">*</span><span class="n">painter</span><span class="p">,</span> <span class="kt">int</span> <span class="n">column</span><span class="p">,</span> <span class="kt">int</span> <span class="n">index</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">isSelect</span><span class="p">)</span>
<span class="p">{</span>
    <span class="kt">int</span> <span class="n">padding</span> <span class="o">=</span> <span class="mi">10</span><span class="p">;</span>
    <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setOpacity</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">isSelect</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setPen</span><span class="p">(</span><span class="n">QPen</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="s">"#FFFFFF"</span><span class="p">)));</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">setPen</span><span class="p">(</span><span class="n">QPen</span><span class="p">(</span><span class="n">QColor</span><span class="p">(</span><span class="s">"#000000"</span><span class="p">)));</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">column</span> <span class="o">==</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">drawText</span><span class="p">(</span><span class="n">QRect</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">padding</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">rect</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="n">padding</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">height</span><span class="p">()),</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignLeft</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignVCenter</span><span class="p">,</span> <span class="n">artist</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">column</span> <span class="o">==</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">drawText</span><span class="p">(</span><span class="n">QRect</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">padding</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">rect</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="n">padding</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">height</span><span class="p">()),</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignLeft</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignVCenter</span><span class="p">,</span> <span class="n">song</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="n">column</span> <span class="o">==</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">painter</span><span class="o">-&gt;</span><span class="n">drawText</span><span class="p">(</span><span class="n">QRect</span><span class="p">(</span><span class="n">rect</span><span class="p">.</span><span class="n">x</span><span class="p">()</span> <span class="o">+</span> <span class="n">padding</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">y</span><span class="p">(),</span> <span class="n">rect</span><span class="p">.</span><span class="n">width</span><span class="p">()</span> <span class="o">-</span> <span class="n">padding</span> <span class="o">*</span> <span class="mi">2</span><span class="p">,</span> <span class="n">rect</span><span class="p">.</span><span class="n">height</span><span class="p">()),</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignRight</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">::</span><span class="n">AlignVCenter</span><span class="p">,</span> <span class="n">length</span><span class="p">);</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div></div>
<p>å”¯ä¸€çš„å˜åŒ–ï¼Œå°±æ˜¯ drawForeground çš„æ—¶å€™ï¼Œåˆ©ç”¨äº† column å‚æ•°ï¼Œæ ¹æ®ä¸åŒçš„åˆ—ç´¢å¼•ï¼Œç»˜åˆ¶ä¸åŒçš„åˆ—æ–‡å­—ï¼Œæœ€ç»ˆçš„æ•ˆæœå›¾å¦‚ä¸‹ï¼š
<img src="http://localhost:4000/pics/dtk/dtk-2.gif" alt="å¤šåˆ—åˆ—è¡¨" /></p>

<p>æ˜¯ä¸æ˜¯å¾ˆç®€å•ï¼Ÿ
æ›´å¤æ‚çš„è‡ªç»˜å†…å®¹ï¼Œåªéœ€ä½¿ç”¨ QPainter è¿›è¡Œä¸åŒçš„å†…å®¹ç»˜åˆ¶å³å¯ï¼Œä»£ç å¤æ‚åº¦ä¸ä¼šå¢åŠ ï¼ŒåŸç†éƒ½ä¸€æ ·ï¼š</p>
<ul>
  <li>ç»˜åˆ¶å›¾æ ‡æ—¶ï¼ŒæŠŠ painter-&gt;drawText æ›¿æ¢æˆ painter-&gt;drawPixmap</li>
  <li>ç»˜åˆ¶è¿›åº¦æ¡æ—¶ï¼ŒæŠŠ painter-&gt;drawText æ›¿æ¢æˆ painter-&gt;drawRect</li>
  <li>â€¦</li>
</ul>

<h3 id="è®¾ç½®è¾¹æ¡†å’Œåœ†è§’">è®¾ç½®è¾¹æ¡†å’Œåœ†è§’</h3>
<p>æœ‰æ—¶å€™è®¾è®¡å¸ˆæ›´é’çå¯¹åˆ—è¡¨æœ‰ä¸€ä¸ªåœ†è§’çš„è¾¹çº¿ï¼Œä»¥æ›´åŠ ä¼˜é›…çš„æ˜¾ç¤ºç•Œé¢ç»†èŠ‚, ç›´æ¥åœ¨DSimpleListViewå­ç±»ä¸­è°ƒç”¨ä¸‹é¢ä¸¤è¡Œä»£ç å³å¯å®ç°ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="c1">// è®¾ç½®ä¸ºtrueæ—¶ç»˜åˆ¶è¾¹æ¡†</span>
    <span class="n">setFrame</span><span class="p">(</span><span class="nb">true</span><span class="p">);</span>

    <span class="c1">// è®¾ç½®è¾¹æ¡†çš„åœ†è§’æ˜¯ 8åƒç´ </span>
    <span class="n">setClipRadius</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
</code></pre></div></div>
<p>å¦‚æœè¦æ§åˆ¶è¾¹çº¿çš„é¢œè‰²å’Œè¾¹çº¿é€æ˜åº¦ï¼Œä¹Ÿéå¸¸ç®€å•ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">setFrame</span><span class="p">(</span><span class="nb">true</span><span class="p">,</span> <span class="n">QColor</span><span class="p">(</span><span class="s">"#FF0000"</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">);</span>
</code></pre></div></div>

<p><img src="http://localhost:4000/pics/dtk/dtk-3.png" alt="åœ†è§’è¾¹æ¡†æ•ˆæœ" /></p>

<h3 id="å¼¹å‡ºå³é”®èœå•">å¼¹å‡ºå³é”®èœå•</h3>
<p>å½“ç”¨æˆ·åœ¨åˆ—è¡¨ä¸­å³é”®æ—¶å¾€å¾€å¸Œæœ›å¼¹å‡ºå³é”®èœå•ï¼Œè¿æ¥ä¿¡å· rightClickItems å³å¯ã€‚</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">rightClickItems</span><span class="p">(</span><span class="n">QPoint</span> <span class="n">pos</span><span class="p">,</span> <span class="n">QList</span><span class="o">&lt;</span><span class="n">DSimpleListItem</span><span class="o">*&gt;</span> <span class="n">items</span><span class="p">);</span>
</code></pre></div></div>
<ul>
  <li>å‚æ•° pos è¡¨ç¤ºç”¨æˆ·å³é”®ç‚¹å‡»çš„ä½ç½®</li>
  <li>å‚æ•° items è¡¨ç¤ºæ‰€æœ‰é€‰ä¸­çš„ items</li>
</ul>

<p>ä»¥ä¸Šé¢çš„å¤šåˆ—åˆ—è¡¨ä¸ºä¾‹ï¼Œå³é”®èœå•å“åº”çš„å®ä¾‹ä»£ç å¦‚ä¸‹ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// åœ¨ multilistview.h ä¸­å£°æ˜ popupMenu slots ç”¨äºå¤„ç† rightClickItems ä¿¡å·</span>
<span class="k">public</span> <span class="n">slots</span><span class="o">:</span>
    <span class="kt">void</span> <span class="n">popupMenu</span><span class="p">(</span><span class="n">QPoint</span> <span class="n">pos</span><span class="p">,</span> <span class="n">QList</span><span class="o">&lt;</span><span class="n">DSimpleListItem</span><span class="o">*&gt;</span> <span class="n">items</span><span class="p">);</span>

<span class="p">...</span>

<span class="c1">// è¿æ¥ä¿¡å· rightClickItems åˆ° popupMenu æ§½</span>
<span class="n">connect</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MultiListView</span><span class="o">::</span><span class="n">rightClickItems</span><span class="p">,</span> <span class="k">this</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">MultiListView</span><span class="o">::</span><span class="n">popupMenu</span><span class="p">,</span> <span class="n">Qt</span><span class="o">::</span><span class="n">QueuedConnection</span><span class="p">);</span>

<span class="p">...</span>

<span class="kt">void</span> <span class="n">MultiListView</span><span class="o">::</span><span class="n">popupMenu</span><span class="p">(</span><span class="n">QPoint</span> <span class="n">pos</span><span class="p">,</span> <span class="n">QList</span><span class="o">&lt;</span><span class="n">DSimpleListItem</span><span class="o">*&gt;</span> <span class="n">items</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// æ„å»ºèœå•ï¼Œä¸ºäº†ä¾¿äºæ¼”ç¤ºï¼Œåªå–é€‰ä¸­çš„ç¬¬ä¸€ä¸ª itemï¼Œç”¨äºèœå•å†…å®¹å±•ç¤º</span>
    <span class="n">QMenu</span> <span class="o">*</span><span class="n">menu</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QMenu</span><span class="p">();</span>
    <span class="n">MultiListItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">items</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
    <span class="n">QAction</span> <span class="o">*</span><span class="n">artistAction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QAction</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">artist</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="n">QAction</span> <span class="o">*</span><span class="n">songAction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QAction</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">song</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>
    <span class="n">QAction</span> <span class="o">*</span><span class="n">lengthAction</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QAction</span><span class="p">(</span><span class="n">item</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">,</span> <span class="k">this</span><span class="p">);</span>

    <span class="n">menu</span><span class="o">-&gt;</span><span class="n">addAction</span><span class="p">(</span><span class="n">artistAction</span><span class="p">);</span>
    <span class="n">menu</span><span class="o">-&gt;</span><span class="n">addAction</span><span class="p">(</span><span class="n">songAction</span><span class="p">);</span>
    <span class="n">menu</span><span class="o">-&gt;</span><span class="n">addAction</span><span class="p">(</span><span class="n">lengthAction</span><span class="p">);</span>

    <span class="c1">// åœ¨ç”¨æˆ·å³é”®çš„åæ ‡å¼¹å‡ºèœå•</span>
    <span class="n">menu</span><span class="o">-&gt;</span><span class="n">exec</span><span class="p">(</span><span class="n">pos</span><span class="p">);</span>
<span class="p">}</span>
</code></pre></div></div>
<p><img src="http://localhost:4000/pics/dtk/dtk-4.gif" alt="å¼¹å‡ºå³é”®èœå•" /></p>

<h3 id="è®¾ç½®åˆ—çš„æ’åºç®—æ³•">è®¾ç½®åˆ—çš„æ’åºç®—æ³•</h3>
<p>å¤šåˆ—åˆ—è¡¨ä¸­æœ€å¸¸ç”¨çš„æ“ä½œå°±æ˜¯æ’åºï¼Œåœ¨ DSimpleListView å®ç°æ’åºéå¸¸ç®€å•ã€‚
é¦–å…ˆåœ¨ DSimpleListItem çš„å­ç±»ä¸­å®ç°é™æ€çš„æ’åºå‡½æ•°ï¼Œä»¥ä¸Šé¢çš„ multilistitem.h ä¸ºä¾‹ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">// multilistview.h</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">sortByArtist</span><span class="p">(</span><span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item1</span><span class="p">,</span> <span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item2</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">descendingSort</span><span class="p">);</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">sortBySong</span><span class="p">(</span><span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item1</span><span class="p">,</span> <span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item2</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">descendingSort</span><span class="p">);</span>
    <span class="k">static</span> <span class="kt">bool</span> <span class="n">sortByLength</span><span class="p">(</span><span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item1</span><span class="p">,</span> <span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item2</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">descendingSort</span><span class="p">);</span>

<span class="c1">// multilistview.cpp</span>
<span class="kt">bool</span> <span class="n">MultiListItem</span><span class="o">::</span><span class="n">sortByArtist</span><span class="p">(</span><span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item1</span><span class="p">,</span> <span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item2</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">descendingSort</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Init.</span>
    <span class="n">QString</span> <span class="n">artist1</span> <span class="o">=</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item1</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">artist</span><span class="p">;</span>
    <span class="n">QString</span> <span class="n">artist2</span> <span class="o">=</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item2</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">artist</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">sortOrder</span> <span class="o">=</span> <span class="n">artist1</span> <span class="o">&gt;</span> <span class="n">artist2</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">descendingSort</span> <span class="o">?</span> <span class="n">sortOrder</span> <span class="o">:</span> <span class="o">!</span><span class="n">sortOrder</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">MultiListItem</span><span class="o">::</span><span class="n">sortBySong</span><span class="p">(</span><span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item1</span><span class="p">,</span> <span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item2</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">descendingSort</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Init.</span>
    <span class="n">QString</span> <span class="n">song1</span> <span class="o">=</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item1</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">song</span><span class="p">;</span>
    <span class="n">QString</span> <span class="n">song2</span> <span class="o">=</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item2</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">song</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">sortOrder</span> <span class="o">=</span> <span class="n">song1</span> <span class="o">&gt;</span> <span class="n">song2</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">descendingSort</span> <span class="o">?</span> <span class="n">sortOrder</span> <span class="o">:</span> <span class="o">!</span><span class="n">sortOrder</span><span class="p">;</span>
<span class="p">}</span>

<span class="kt">bool</span> <span class="n">MultiListItem</span><span class="o">::</span><span class="n">sortByLength</span><span class="p">(</span><span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item1</span><span class="p">,</span> <span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item2</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">descendingSort</span><span class="p">)</span>
<span class="p">{</span>
    <span class="c1">// Init.</span>
    <span class="n">QString</span> <span class="n">length1</span> <span class="o">=</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item1</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">;</span>
    <span class="n">QString</span> <span class="n">length2</span> <span class="o">=</span> <span class="p">(</span><span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item2</span><span class="p">))</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">;</span>
    <span class="kt">bool</span> <span class="n">sortOrder</span> <span class="o">=</span> <span class="n">length1</span> <span class="o">&gt;</span> <span class="n">length2</span><span class="p">;</span>

    <span class="k">return</span> <span class="n">descendingSort</span> <span class="o">?</span> <span class="n">sortOrder</span> <span class="o">:</span> <span class="o">!</span><span class="n">sortOrder</span><span class="p">;</span>
<span class="p">}</span>
</code></pre></div></div>
<p>ä¸Šé¢ä¸‰ä¸ªé™æ€æ’åºå‡½æ•°åˆ†åˆ«å¯¹ artistã€songã€lengthä¸‰åˆ—æä¾›æ’åºç®—æ³•ï¼Œ å‚æ•° descendingSort è¡¨ç¤ºæ’åºæ˜¯å¦æ˜¯å‡åºè¿˜æ˜¯é™åºã€‚</p>

<p>ç„¶ååœ¨ DSimpleListView çš„å­ç±»ä¸­è°ƒç”¨ setColumnSortingAlgorithms å‡½æ•°å³å¯ï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code>    <span class="n">QList</span><span class="o">&lt;</span><span class="n">SortAlgorithm</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">alorithms</span> <span class="o">=</span> <span class="k">new</span> <span class="n">QList</span><span class="o">&lt;</span><span class="n">SortAlgorithm</span><span class="o">&gt;</span><span class="p">();</span>
    <span class="n">alorithms</span><span class="o">-&gt;</span><span class="n">append</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MultiListItem</span><span class="o">::</span><span class="n">sortByArtist</span><span class="p">);</span>
    <span class="n">alorithms</span><span class="o">-&gt;</span><span class="n">append</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MultiListItem</span><span class="o">::</span><span class="n">sortBySong</span><span class="p">);</span>
    <span class="n">alorithms</span><span class="o">-&gt;</span><span class="n">append</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MultiListItem</span><span class="o">::</span><span class="n">sortByLength</span><span class="p">);</span>
    <span class="n">setColumnSortingAlgorithms</span><span class="p">(</span><span class="n">alorithms</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">true</span><span class="p">);</span>
</code></pre></div></div>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">setColumnSortingAlgorithms</span><span class="p">(</span><span class="n">QList</span><span class="o">&lt;</span><span class="n">SortAlgorithm</span><span class="o">&gt;</span> <span class="o">*</span><span class="n">algorithms</span><span class="p">,</span> <span class="kt">int</span> <span class="n">sortColumn</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="kt">bool</span> <span class="n">descendingSort</span><span class="o">=</span><span class="nb">false</span><span class="p">);</span>
</code></pre></div></div>
<p>setColumnSortingAlgorithms åˆ—æ’åºæ¥å£çš„å‚æ•°ä¾æ¬¡è¡¨ç¤ºï¼š</p>
<ul>
  <li>algorithms åˆ—å¯¹åº”çš„é™æ€æ’åºå‡½æ•°ï¼Œé•¿åº¦å¿…é¡»å’Œåˆ—çš„æ•°é‡ä¿æŒä¸€è‡´</li>
  <li>sortColumn é»˜è®¤æ’åºçš„åˆ—ï¼Œè®¾ç½®æˆ 0 è¡¨ç¤ºç¬¬ä¸€åˆ—</li>
  <li>descendingSort æ˜¯å¦æ˜¯é™åºæ’åˆ—ï¼Ÿ</li>
</ul>

<p>æœ€ç»ˆçš„æ’åºæ•ˆæœå¦‚ä¸‹å›¾ï¼š
<img src="http://localhost:4000/pics/dtk/dtk-5.gif" alt="åˆ—è¡¨æ’åº" /></p>

<h3 id="æœç´¢åˆ—è¡¨">æœç´¢åˆ—è¡¨</h3>
<p>æœç´¢åˆ—è¡¨çš„å®ç°åŸç†ï¼Œç°åœ¨ DSimpleListItem å­ç±»æ„å»ºæœç´¢å‡½æ•°:</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">static</span> <span class="kt">bool</span> <span class="n">search</span><span class="p">(</span><span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item</span><span class="p">,</span> <span class="n">QString</span> <span class="n">searchContent</span><span class="p">);</span>

<span class="kt">bool</span> <span class="n">MultiListItem</span><span class="o">::</span><span class="n">search</span><span class="p">(</span><span class="k">const</span> <span class="n">DSimpleListItem</span> <span class="o">*</span><span class="n">item</span><span class="p">,</span> <span class="n">QString</span> <span class="n">searchContent</span><span class="p">)</span>
<span class="p">{</span>
    <span class="k">const</span> <span class="n">MultiListItem</span> <span class="o">*</span><span class="n">item</span> <span class="o">=</span> <span class="k">static_cast</span><span class="o">&lt;</span><span class="k">const</span> <span class="n">MultiListItem</span><span class="o">*&gt;</span><span class="p">(</span><span class="n">item</span><span class="p">);</span>

    <span class="k">return</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">artist</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">searchContent</span><span class="p">)</span> <span class="o">||</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">song</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">searchContent</span><span class="p">)</span> <span class="o">||</span> <span class="n">item</span><span class="o">-&gt;</span><span class="n">length</span><span class="p">.</span><span class="n">contains</span><span class="p">(</span><span class="n">searchContent</span><span class="p">);</span>
<span class="p">}</span>

</code></pre></div></div>
<p>ç„¶ååœ¨è°ƒç”¨ DSimpleListView å­ç±»çš„setSearchAlgorithm å‡½æ•°å³å¯è®¾ç½®åˆ—è¡¨çš„æœç´¢å‡½æ•°ï¼Œæ³¨æ„ï¼ŒDTK Simple ListView æ‰€æœ‰å¹²æ´»çš„å‡½æ•°å…¶å®éƒ½æ˜¯ DSimpleListItem å„ç§æ¥å£å»å®ç°çš„ï¼Œ DSimpleListView åªæä¾›æ¡†æ¶å®ç°</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">setSearchAlgorithm</span><span class="p">(</span><span class="o">&amp;</span><span class="n">MultiListItem</span><span class="o">::</span><span class="n">search</span><span class="p">);</span>
</code></pre></div></div>

<p>æœ€åï¼Œæ¯æ¬¡åœ¨ DSimpleListView è°ƒç”¨ search å‡½æ•°çš„æ—¶å€™ï¼ŒDSimpleListView è‡ªåŠ¨ä¼šæ ¹æ® setSearchAlgorithm è®¾ç½®çš„æœç´¢ç®—æ³•å¯¹åˆ—è¡¨çš„è¡Œè¿›è¡Œè¿‡æ»¤æ˜¾ç¤ºï¼š</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">search</span><span class="p">(</span><span class="n">QString</span> <span class="n">searchContent</span><span class="p">);</span>
</code></pre></div></div>

<p>æœç´¢æ•ˆæœå¦‚ä¸‹å›¾ï¼ˆç›—ç”¨æ·±åº¦ç›‘è§†å™¨çš„æ•ˆæœï¼‰ï¼š
<img src="http://localhost:4000/pics/dtk/dtk-6.gif" alt="æœç´¢åˆ—è¡¨" /></p>

<h3 id="éšè—æŒ‡å®šåˆ—">éšè—æŒ‡å®šåˆ—</h3>
<p>DSimpleListView çš„ setColumnHideFlags æ¥å£å¯ä»¥ç”¨äºæ§åˆ¶åˆ—è¡¨ä¸­ç½®é¡¶åˆ—çš„æ˜¯å¦æ˜¾ç¤º</p>

<div class="language-c++ highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="kt">void</span> <span class="n">setColumnHideFlags</span><span class="p">(</span><span class="n">QList</span><span class="o">&lt;</span><span class="kt">bool</span><span class="o">&gt;</span> <span class="n">toggleHideFlags</span><span class="p">,</span> <span class="kt">int</span> <span class="n">alwaysVisibleColumn</span><span class="o">=-</span><span class="mi">1</span><span class="p">);</span>
</code></pre></div></div>
<ul>
  <li>å‚æ•° toggleHideFlags è¡¨ç¤ºå¯¹åº”åˆ—çš„éšè—çŠ¶æ€ï¼Œ true è¡¨ç¤ºæ˜¾ç¤ºï¼Œ false è¡¨ç¤ºéšè—</li>
  <li>å‚æ•° alwaysVisibleColumn è¡¨ç¤ºæ°¸è¿œæ˜¾ç¤ºçš„ä¸€åˆ—ï¼Œé»˜è®¤ -1 è¡¨ç¤ºæ‰€æœ‰åˆ—éƒ½å¯ä»¥éšè—</li>
</ul>

<p>å…·ä½“çš„æ•ˆæœå¦‚ä¸‹å›¾ï¼š
<img src="http://localhost:4000/pics/dtk/dtk-7.gif" alt="éšè—åˆ—" /></p>
:ET